<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Mr.Onion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ä¸€ä¸ªè®°å½•æˆé•¿çš„å‰ç«¯åšå®¢">
<meta property="og:type" content="website">
<meta property="og:title" content="Mr.Onion">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Mr.Onion">
<meta property="og:description" content="ä¸€ä¸ªè®°å½•æˆé•¿çš„å‰ç«¯åšå®¢">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mr.Onion">
<meta property="article:tag" content="HTMLã€JavaScriptã€Cssã€Webã€å‰ç«¯">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Mr.Onion" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Mr.Onion</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="æœç´¢"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-JSæ•°æ®ç±»å‹åˆ¤æ–­" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/15/JS%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD/" class="article-date">
  <time datetime="2020-08-15T14:52:01.000Z" itemprop="datePublished">2020-08-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/15/JS%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD/">JSæ•°æ®ç±»å‹åˆ¤æ–­</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="å‰ç«¯æ•°æ®ç±»å‹åˆ¤æ–­"><a href="#å‰ç«¯æ•°æ®ç±»å‹åˆ¤æ–­" class="headerlink" title="å‰ç«¯æ•°æ®ç±»å‹åˆ¤æ–­"></a><strong>å‰ç«¯æ•°æ®ç±»å‹åˆ¤æ–­</strong></h1><blockquote>
<p>å‰ç«¯æ•°æ®ç±»å‹åˆ¤æ–­åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä¼šé‡åˆ°ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆè¯¥æ€ä¹ˆåˆ¤æ–­å„ç§ä¸åŒçš„æ•°æ®ç±»å‹å‘¢ï¼Ÿé€šè¿‡é˜…è¯»æ–‡ç« ï¼Œç»™ä½ ä¸€å¥—å®Œæ•´çš„åˆ¤æ–­æ–¹æ³•ä»¥åŠå¯¹å‰ç«¯JSé‡Œæ•°æ®ç±»å‹çš„åŸºæœ¬äº†è§£ã€‚</p>
</blockquote>
<h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><p>javascriptä¸­çš„åŸºç¡€æ•°æ®ç±»å‹å…±æœ‰8ç§</p>
<ol>
<li>string</li>
<li>numberï¼ˆç‰¹æ®Šå€¼NaNï¼‰</li>
<li>boolean</li>
<li>undefined</li>
<li>objectï¼ˆæ­£åˆ™è¡¨è¾¾å¼ã€arrayã€mapã€setã€functionå±äºå¯¹è±¡ç±»å‹ï¼‰</li>
<li>null</li>
<li>symbol</li>
<li>bigInt</li>
</ol>
<h2 id="åˆ¤æ–­æ–¹æ³•"><a href="#åˆ¤æ–­æ–¹æ³•" class="headerlink" title="åˆ¤æ–­æ–¹æ³•"></a>åˆ¤æ–­æ–¹æ³•</h2><h3 id="typeofæ–¹æ³•åˆ¤æ–­"><a href="#typeofæ–¹æ³•åˆ¤æ–­" class="headerlink" title="typeofæ–¹æ³•åˆ¤æ–­"></a>typeofæ–¹æ³•åˆ¤æ–­</h3><p>ä¸‹é¢ä»£ç åˆ—å‡ºæˆ‘ä»¬å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„æ•°æ®ç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="number">1</span> <span class="comment">// &#x27;number&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">NaN</span> <span class="comment">// &#x27;number&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">&#x27;1&#x27;</span> <span class="comment">// &#x27;string&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">true</span> <span class="comment">// &#x27;boolean&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span> <span class="comment">// &#x27;undefined&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span> <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> [] <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> &#123;&#125; <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> /\d/ <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&#x27;2020&#x27;</span>) <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">Map</span>() <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">Set</span>() <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125; <span class="comment">// &#x27;function&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">Symbol</span>() <span class="comment">// &#x27;symbol&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> BigInt(<span class="number">1</span>) <span class="comment">// &#x27;bigInt&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æŠŠç»“æœæ•´ç†æˆè¡¨æ ¼å¦‚ä¸‹æ–¹è¡¨æ ¼å±•ç¤ºï¼Œé€šè¿‡è¡¨æ ¼ä¸­çš„ç»“æœå¯¹æ¯”æ¥çœ‹ï¼Œä½¿ç”¨<code>typeof</code>æ–¹æ³•åˆ¤æœ‰ä»¥ä¸‹2ä¸ªç¼ºé™·ï¼š</p>
<ol>
<li>æ— æ³•åŒºåˆ†<strong>æ•°å­—</strong>å’Œ<strong>NaN</strong></li>
<li>æ— æ³•åŒºåˆ†<strong>null</strong>ã€**{}<strong>ã€</strong>[]<strong>ã€</strong>/\d/<strong>ã€</strong>new Map()<strong>ã€</strong>new Set()**è¿™äº›å¯¹è±¡ç±»å‹</li>
</ol>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td>1ã€NaN</td>
<td>number</td>
</tr>
<tr>
<td>â€˜1â€™</td>
<td>string</td>
</tr>
<tr>
<td>true</td>
<td>boolean</td>
</tr>
<tr>
<td>nullã€{}ã€[]ã€/\d/ã€new Map()ã€new Set()</td>
<td>object</td>
</tr>
<tr>
<td>function() {}</td>
<td>function</td>
</tr>
<tr>
<td>Symbol()</td>
<td>symbol</td>
</tr>
<tr>
<td>BigInt(1)</td>
<td>bigInt</td>
</tr>
</tbody></table>
<h3 id="toStringæ–¹æ³•åˆ¤æ–­"><a href="#toStringæ–¹æ³•åˆ¤æ–­" class="headerlink" title="toStringæ–¹æ³•åˆ¤æ–­Â "></a>toStringæ–¹æ³•åˆ¤æ–­Â </h3><p><code>toString</code>æ–¹æ³•æ˜¯åˆ¤æ–­æ•°æ®ç±»å‹æœ€ç²¾ç¡®çš„ï¼Œä¸‹é¢ä»£ç åˆ—å‡ºæˆ‘ä»¬å¼€å‘ä¸­ç»å¸¸ç”¨åˆ°çš„æ•°æ®ç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œä»£ç å¦‚ä¸‹ğŸ‘‡</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(val)</span><br><span class="line">&#125;</span><br><span class="line">func(<span class="number">1</span>) <span class="comment">// &#x27;[object Number]&#x27;</span></span><br><span class="line">func(<span class="literal">NaN</span>) <span class="comment">// &#x27;[object Number]&#x27;</span></span><br><span class="line">func(<span class="string">&#x27;1&#x27;</span>) <span class="comment">// &#x27;[object String]&#x27;</span></span><br><span class="line">func(<span class="literal">true</span>) <span class="comment">// &#x27;[object Boolean]&#x27;</span></span><br><span class="line">func(<span class="literal">undefined</span>) <span class="comment">// &#x27;[object Undefined]&#x27;</span></span><br><span class="line">func(<span class="literal">null</span>) <span class="comment">// &#x27;[object Null]&#x27;</span></span><br><span class="line">func([]) <span class="comment">// &#x27;[object Array]&#x27;</span></span><br><span class="line">func(&#123;&#125;) <span class="comment">// &#x27;[object Object]&#x27;</span></span><br><span class="line">func(<span class="regexp">/\d/</span>) <span class="comment">// &#x27;[object RegExp]&#x27;</span></span><br><span class="line">func(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&#x27;2020&#x27;</span>)) <span class="comment">// &#x27;[object Date]&#x27;</span></span><br><span class="line">func(<span class="keyword">new</span> <span class="built_in">Map</span>()) <span class="comment">// &#x27;[object Map]&#x27;</span></span><br><span class="line">func(<span class="keyword">new</span> <span class="built_in">Set</span>()) <span class="comment">// &#x27;[object Set]&#x27;</span></span><br><span class="line">func(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) <span class="comment">// &#x27;[object Function]&#x27;</span></span><br><span class="line">func(<span class="built_in">Symbol</span>()) <span class="comment">// &#x27;[object Symbol]&#x27;</span></span><br><span class="line">func(BigInt(<span class="number">1</span>)) <span class="comment">// &#x27;[object BigInt]&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æŠŠç»“æœæ•´ç†æˆè¡¨æ ¼å¦‚ä¸‹æ–¹è¡¨æ ¼å±•ç¤ºï¼Œé€šè¿‡è¡¨æ ¼ä¸­çš„ç»“æœå¯¹æ¯”æ¥çœ‹ï¼Œä½¿ç”¨<code>toString</code>æ–¹æ³•åˆ¤æ–­æ•°æ®ç±»å‹å·²ç»æ¥è¿‘å®Œç¾ï¼Œä½†æ˜¯ç‰¹æ®Šçš„å€¼<code>NaN</code>è¿˜æ˜¯æ— æ³•åŒºåˆ†ï¼Œä¸è¿‡è¿™ä¸ªæ•°æ®åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿˜æ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œåˆ¤æ–­æ–¹æ³•åœ¨ä¸‹æ–‡è¡¥å……ã€‚</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td>1ã€NaN</td>
<td>[object Number]</td>
</tr>
<tr>
<td>â€˜1â€™</td>
<td>[object String]</td>
</tr>
<tr>
<td>true</td>
<td>[object Boolean]</td>
</tr>
<tr>
<td>undefined</td>
<td>[object Undefined]</td>
</tr>
<tr>
<td>null</td>
<td>[object Null]</td>
</tr>
<tr>
<td>[]</td>
<td>[object Array]</td>
</tr>
<tr>
<td>{}</td>
<td>[object Object]</td>
</tr>
<tr>
<td>/\d/</td>
<td>[object RegExp]</td>
</tr>
<tr>
<td>new Date(â€˜2020â€™)</td>
<td>[object Date]</td>
</tr>
<tr>
<td>new Map()</td>
<td>[object Map]</td>
</tr>
<tr>
<td>new Set()</td>
<td>[object Set]</td>
</tr>
<tr>
<td>function() {}</td>
<td>[object Function]</td>
</tr>
<tr>
<td>Symbol()</td>
<td>[object Symbol]</td>
</tr>
<tr>
<td>BigInt(1)</td>
<td>[object BigInt]</td>
</tr>
</tbody></table>
<h2 id="ç‰¹æ®Šç‚¹"><a href="#ç‰¹æ®Šç‚¹" class="headerlink" title="ç‰¹æ®Šç‚¹"></a>ç‰¹æ®Šç‚¹</h2><ul>
<li><p>é€šè¿‡å‰æ–‡ä¸­æ•´ç†å¯å¾—ï¼Œ<code>NaN</code>è¿™ä¸ªç‰¹æ®Šå€¼æ— è®ºæ˜¯ç”¨<code>typeof</code>è¿˜æ˜¯<code>toString</code>éƒ½æ— æ³•åŒºåˆ†ï¼Œåˆ¤æ–­è¿™ä¸ªå€¼æœ€å¥½ä½¿ç”¨<code>Number.isNaN</code>ï¼Œè¯¥æ–¹æ³•è¿”è¿˜ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.isNaN(<span class="literal">NaN</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿˜æœ‰ä¸€ç±»æ•°æ®æ˜¯ä½¿ç”¨æ„é€ å‡½æ•°ç”Ÿæˆï¼Œè¿™ç§æ•°æ®ä»ä½¿ç”¨<code>typeof</code>å’Œ<code>toString</code>å¾—åˆ°çš„ç»“æœæ¥çœ‹ï¼Œ<code>typeof</code>æ–¹æ³•å¾—åˆ°çš„ç»“æœä¼šæ›´å‡†ç¡®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(val)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newStr = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> newNum = <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> newBool = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> newStr <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> newNum <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"><span class="keyword">typeof</span> newBool <span class="comment">// &#x27;object&#x27;</span></span><br><span class="line"></span><br><span class="line">func(newStr) <span class="comment">// &#x27;[object String]&#x27;</span></span><br><span class="line">func(newNum) <span class="comment">// &#x27;[object Number]&#x27;</span></span><br><span class="line">func(newBool) <span class="comment">// &#x27;[object Boolean]&#x27;</span></span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢ä»£ç å¯ä»¥å¾—åˆ°ï¼Œåœ¨è¿™ä¸ªæ—¶å€™è™½ç„¶ä½¿ç”¨<code>toString</code>æ–¹æ³•å¾—åˆ°çš„æ•°æ®æ„é€ æ–¹æ³•æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯çœŸæ­£çš„å˜é‡è¿”å›ç»“æœå´æ˜¯å¯¹è±¡ç±»å‹çš„ï¼Œå¯¹äºè¿™ç§ä½¿ç”¨æ„é€ å‡½æ•°å¾—åˆ°çš„è¿”å›å€¼ï¼Œç»“åˆ<code>typeof</code>å’Œ<code>toString</code>ä¸€èµ·åˆ¤æ–­æ˜¯æœ€ç²¾ç¡®çš„ã€‚</p>
</li>
<li><p>å¯¹äºåˆ¤æ–­æ•°ç»„ç±»å‹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æ–°çš„è¯­æ³•<code>Array.isArray</code>åˆ¤æ–­ï¼Œè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/15/JS%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD/" data-id="ckedpbrub00061zm16qfr1jel" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-CSSå®¹æ˜“å¿½ç•¥çš„ä¸€äº›çŸ¥è¯†ç‚¹" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/10/CSS%E5%AE%B9%E6%98%93%E5%BF%BD%E7%95%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9/" class="article-date">
  <time datetime="2019-08-10T09:27:40.000Z" itemprop="datePublished">2019-08-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CSS/">CSS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/10/CSS%E5%AE%B9%E6%98%93%E5%BF%BD%E7%95%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9/">CSSå®¹æ˜“å¿½ç•¥çš„ä¸€äº›çŸ¥è¯†ç‚¹</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="inlineå…ƒç´ ã€inline-blockå…ƒç´ ã€blockå…ƒç´ çš„åŒºåˆ«"><a href="#inlineå…ƒç´ ã€inline-blockå…ƒç´ ã€blockå…ƒç´ çš„åŒºåˆ«" class="headerlink" title="inlineå…ƒç´ ã€inline-blockå…ƒç´ ã€blockå…ƒç´ çš„åŒºåˆ«"></a><code>inline</code>å…ƒç´ ã€<code>inline-block</code>å…ƒç´ ã€<code>block</code>å…ƒç´ çš„åŒºåˆ«</h2><ol>
<li><code>inline</code>å…ƒç´ æ ¹æ®å®½åº¦æ¨ªå‘æ’åˆ—ï¼Œ<code>block</code>å…ƒç´ é»˜è®¤ç‹¬å ä¸€è¡Œï¼›</li>
<li><code>inline</code>å…ƒç´ æ— æ³•è®¾ç½®ä¸Šä¸‹å¤–è¾¹è·(<code>margin</code>)ã€<code>width</code>ã€<code>height</code>ï¼Œ<code>block</code>å…ƒç´ å¯ä»¥è®¾ç½®å››ä¸ªæ–¹å‘çš„å¤–è¾¹è·å’Œå…ƒç´ çš„<code>width</code>ã€<code>height</code>ï¼›</li>
<li><code>inline-block</code>å…ƒç´ åˆ™èåˆäº†<code>inline</code>å…ƒç´ å’Œ<code>block</code>å…ƒç´ ï¼Œå¯ä»¥åƒ<code>inline</code>å…ƒç´ æ¨ªå‘æ’åˆ—ä»¥åŠåƒ<code>block</code>å…ƒç´ è®¾ç½®å››ä¸ªæ–¹å‘çš„å¤–è¾¹è·ä»¥åŠ<code>width</code>ã€<code>height</code>ï¼›</li>
</ol>
<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/8/10/16c7a14e82ef9a8e?w=740&h=758&f=png&s=57903"></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;display: block;width: 100px;height: 100px;background-color: red;margin: 10px;padding: 10px;border: 1px solid grey;&quot;&gt;block&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;display: inline-block;width: 100px;height: 100px;background-color: blue;margin: 10px;padding: 10px;border: 1px solid grey;&quot;&gt;inline-block&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;display: inline;width: 100px;height: 100px;background-color: yellow;margin: 10px;padding: 10px;border: 1px solid grey;&quot;&gt;inline&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç»™<code>inline</code>å…ƒç´ è®¾ç½®å››ä¸ªæ–¹å‘å¤–è¾¹è·ï¼Œåªæœ‰å·¦å³çš„å¤–è¾¹è·æ‰æ˜¾ç¤ºå‡ºäº†æ•ˆæœã€‚</p>
<h2 id="flex-growå®¹æ˜“å¿½ç•¥çš„å‘"><a href="#flex-growå®¹æ˜“å¿½ç•¥çš„å‘" class="headerlink" title="flex-growå®¹æ˜“å¿½ç•¥çš„å‘"></a><code>flex-grow</code>å®¹æ˜“å¿½ç•¥çš„å‘</h2><p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>flex-grow</code>çš„å®šä¹‰ï¼š</p>
<p><code>flex-grow</code>å±æ€§å®šä¹‰é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º0ï¼Œå³å¦‚æœå­˜åœ¨å‰©ä½™ç©ºé—´ï¼Œä¹Ÿä¸æ”¾å¤§ã€‚</p>
<p>å¦‚æœæ‰€æœ‰é¡¹ç›®çš„<code>flex-grow</code>å±æ€§éƒ½ä¸º1ï¼Œåˆ™å®ƒä»¬å°†ç­‰åˆ†å‰©ä½™ç©ºé—´ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„<code>flex-grow</code>å±æ€§ä¸º2ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º1ï¼Œåˆ™å‰è€…å æ®çš„å‰©ä½™ç©ºé—´å°†æ¯”å…¶ä»–é¡¹å¤šä¸€å€ã€‚</p>
<p>æ ¹æ®å®šä¹‰æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå½“åœ¨<code>flex</code>å®¹å™¨å†…ç»™å®¹å™¨å†…çš„é¡¹ç›®è®¾ç½®ä¸åŒçš„<code>flex-grow</code>ï¼Œå¯ä»¥æ ¹æ®æ¯”ä¾‹è®¾ç½®é¡¹ç›®çš„ç©ºé—´ï¼›</p>
<p>å…ˆçœ‹ç¬¬ä¸€ä¸ªä¾‹å­ï¼š</p>
<p><code>flex</code>å®¹å™¨å®½åº¦ä¸º<code>780px</code>ï¼Œå®¹å™¨å†…æœ‰ä¸‰ä¸ªé¡¹ç›®ï¼Œç¬¬ä¸€ä¸ªé¡¹ç›®å›ºå®šå®½åº¦<code>480px</code>ï¼Œå‰©ä¸‹çš„ä¸¤ä¸ªé¡¹ç›®æ ¹æ®æ¯”ä¾‹åˆ†é…ã€‚</p>
<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/8/10/16c7a23650a45341?w=1570&h=522&f=jpeg&s=48236"></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style&#x3D;&quot;display: flex;color: grey;width: 780px;&quot;&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-basis: 480px;background-color: red;&quot;&gt;width480px&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-grow: 2;background-color: blue;&quot;&gt;flex-grow: 2&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-grow: 1;background-color: yellow;&quot;&gt;flex-grow: 1&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<p>ä»æ•ˆæœå›¾å¾—çŸ¥ï¼Œé™¤äº†å›ºå®šå®½åº¦çš„é¡¹ç›®ï¼Œå¦å¤–ä¸¤ä¸ªé¡¹ç›®çš„å®½åº¦å¹¶æœªæŒ‰ç…§æˆ‘ä»¬æ‰€æƒ³çš„é‚£æ ·åˆ†é…ã€‚</p>
<p>é‡æ–°å»çœ‹å®šä¹‰ï¼Œåˆ†é…â€œ_å‰©ä½™ç©ºé—´_â€ä¼¼ä¹å¹¶ä¸æ˜¯æˆ‘ä»¬ç†è§£çš„é‚£æ ·ï¼Œå…·ä½“è¿™ä¸ªâ€œ_å‰©ä½™ç©ºé—´_â€æ˜¯å¦‚ä½•è®¡ç®—æˆ‘å¹¶æœªå…·ä½“å»ç ”ç©¶ï¼Œåœ¨è¿™é‡Œå…ˆè¯´è¯´å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>å½“å‰©ä½™ä¸¤ä¸ªé¡¹ç›®å†…ä¸å­˜åœ¨å†…å®¹çš„æ—¶å€™ï¼Œåˆ†é…çš„ç©ºé—´å°±æ˜¯æ­£ç¡®çš„ï¼›<br>æ•ˆæœå›¾å¦‚ä¸‹ï¼š<br><img src="https://user-gold-cdn.xitu.io/2019/8/10/16c7a2b825c7ad9b?w=1602&h=422&f=jpeg&s=30203"><br>ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style&#x3D;&quot;display: flex;color: grey;width: 780px;&quot;&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-basis: 480px;background-color: red;&quot;&gt;width480px&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-grow: 2;background-color: blue;&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-grow: 1;background-color: yellow;&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬æŠŠé™¤äº†å›ºå®šå®½åº¦å¤–çš„é¡¹ç›®çš„å†…å®¹å»æ‰ï¼Œåˆ†é…çš„ç©ºé—´æ¯”ä¾‹å°±æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯è¿™ç§è§£å†³æ–¹æ³•è‚¯å®šä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<ol start="2">
<li>ç»™å‰©ä½™ä¸¤ä¸ªé¡¹ç›®è®¾ç½®<code>flex-basic: 0;</code></li>
</ol>
<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š<br><img src="https://user-gold-cdn.xitu.io/2019/8/10/16c7a2e66c7eb215?w=1604&h=566&f=jpeg&s=51175"><br>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style&#x3D;&quot;display: flex;color: grey;width: 780px;&quot;&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-basis: 480px;background-color: red;&quot;&gt;width480px&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-grow: 2;background-color: blue;flex-basis: 0;&quot;&gt;flex-grow: 2&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-grow: 1;background-color: yellow;flex-basis: 0;&quot;&gt;flex-grow: 1&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œå½“æˆ‘ä»¬ç»™é™¤äº†å›ºå®šå®½åº¦å¤–çš„é¡¹ç›®åŠ ä¸Š<code>flex-basic: 0</code>åï¼Œåˆ†é…çš„ç©ºé—´å°±æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„é‚£æ ·äº†ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>flex-grow</code>æ¥åˆ†é…<code>flex</code>å®¹å™¨å†…çš„é¡¹ç›®ï¼Œä¸€å®šè¦æ³¨æ„è®¾ç½®<code>flex-basic</code>ã€‚å› ä¸ºè¿™é‡Œçš„â€œ_å‰©ä½™ç©ºé—´_â€å’Œ<code>flex-basic</code>ç›¸å…³ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹<code>flex-basic</code>çš„å®šä¹‰ï¼š</p>
<p><code>flex-basic</code>å±æ€§å®šä¹‰äº†åœ¨åˆ†é…å¤šä½™ç©ºé—´ä¹‹å‰ï¼Œé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´ï¼ˆmain sizeï¼‰ã€‚æµè§ˆå™¨æ ¹æ®è¿™ä¸ªå±æ€§ï¼Œè®¡ç®—ä¸»è½´æ˜¯å¦æœ‰å¤šä½™ç©ºé—´ã€‚å®ƒçš„é»˜è®¤å€¼ä¸ºautoï¼Œå³é¡¹ç›®çš„æœ¬æ¥å¤§å°ã€‚</p>
<p>å½“æˆ‘ä»¬ä¸€ä¸ª<code>flex</code>å®¹å™¨å†…çš„é¡¹ç›®åŒæ—¶å­˜åœ¨<code>flex-basic</code>å’Œ<code>flex-grow</code>ï¼Œè¿™ä¸ªé¡¹ç›®çš„å®½åº¦ä¸º<code>flex-basic</code>çš„å€¼åŠ ä¸Š<code>flex-grow</code>æ‰€åˆ†é…åˆ°çš„ç©ºé—´ã€‚</p>
<p>è¿˜æ˜¯ä»¥ä¸Šé¢çš„ä»£ç ä¸¾ä¾‹ï¼Œå‡å¦‚æˆ‘ä»¬ç»™ä¸¤ä¸ªé¡¹ç›®çš„<code>flex-basic</code>è®¾ç½®å€¼ä¸º<code>30px</code>å’Œ<code>60px</code></p>
<p>åˆ™å‰©ä½™ä¸¤ä¸ªå®¹å™¨çš„å®½åº¦åˆ†åˆ«ä¸ºï¼š</p>
<p><code>width1 = ((780 - 480 - 30 - 60) * 2 / 3) + 30 = 170</code></p>
<p><code>width2 = ((780 - 480 - 30 - 60) * 1 / 3) + 60 = 130</code></p>
<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/8/10/16c7a5a01b1f48fe?w=1610&h=494&f=jpeg&s=54951"><br>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style&#x3D;&quot;display: flex;color: grey;width: 780px;&quot;&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-basis: 480px;background-color: red;&quot;&gt;width480px&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-grow: 2;background-color: blue;flex-basis: 30px;&quot;&gt;flex-grow: 2&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div style&#x3D;&quot;height:100px;flex-grow: 1;background-color: yellow;flex-basis: 60px;&quot;&gt;flex-grow: 1&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="å¤šä¸ªclassæ ·å¼çš„æ—¶å€™å¦‚ä½•å–å€¼ï¼Ÿ"><a href="#å¤šä¸ªclassæ ·å¼çš„æ—¶å€™å¦‚ä½•å–å€¼ï¼Ÿ" class="headerlink" title="å¤šä¸ªclassæ ·å¼çš„æ—¶å€™å¦‚ä½•å–å€¼ï¼Ÿ"></a>å¤šä¸ª<code>class</code>æ ·å¼çš„æ—¶å€™å¦‚ä½•å–å€¼ï¼Ÿ</h2><p>å½“æŸä¸ª<code>div</code>å…ƒç´ ä¸Š<code>class</code>çš„å€¼ä¸º<code>a b c</code>çš„æ—¶å€™ï¼Œæœ€åçš„æ ·å¼æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;a b c&quot;&gt;&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé—®é¢˜æˆ‘ä»¬è®¨è®ºçš„å‰ææ˜¯åŒæ ·çš„æ ·å¼å±æ€§ï¼›</p>
<ol>
<li>ä¸è€ƒè™‘æƒé‡çš„æƒ…å†µä¸‹ï¼Œ<code>a b c</code>æœ€ç»ˆå†³å®šå…ƒç´ çš„æ ·å¼ä¸ºåŠ è½½çš„é¡ºåºï¼Œå“ªä¸ª<code>class</code>æœ€ååŠ è½½åˆ™æ˜¾ç¤ºä¸ºå“ªä¸ª<code>class</code>çš„æ•ˆæœï¼Œå’Œä¹¦å†™é¡ºåºæ— å…³ã€‚</li>
</ol>
<ul>
<li>å½“<code>a b c</code>éƒ½åœ¨åŒä¸€ä¸ªæ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œå“ªä¸ªå®šä¹‰åœ¨æœ€åï¼Œåˆ™ä»¥æœ€åçš„ä¸ºå‡†ï¼›</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.c &#123;</span><br><span class="line">    background-color: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.b &#123;</span><br><span class="line">    background-color: yellow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.a &#123;</span><br><span class="line">    background-color: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å½“<code>a b c</code>åœ¨ä¸åŒçš„æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œå“ªä¸ªæ–‡ä»¶æœ€ååŠ è½½ï¼Œåˆ™ä»¥æœ€åçš„ä¸ºå‡†ï¼›</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;cssC.css&quot;&gt;</span><br><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;cssB.css&quot;&gt;</span><br><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;cssA.css&quot;&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>å¦‚æœæŸä¸ª<code>class</code>ä¸­è®¾ç½®äº†<code>!important</code>ï¼Œåˆ™ç›´æ¥ä»¥<code>!important</code>çš„ä¸ºå‡†ã€‚</p>
</li>
<li><p>å…¶ä»–æ—¶å€™åˆ™æŒ‰ç…§é€‰æ‹©å™¨çš„æƒé‡æ¥è®¡ç®—æ ·å¼ã€‚</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/10/CSS%E5%AE%B9%E6%98%93%E5%BF%BD%E7%95%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9/" data-id="ckedpbru200011zm10cb5cgg6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-å­¦ä¹ vuexæºç " class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/15/%E5%AD%A6%E4%B9%A0vuex%E6%BA%90%E7%A0%81/" class="article-date">
  <time datetime="2019-07-15T09:43:10.000Z" itemprop="datePublished">2019-07-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>â–º<a class="article-category-link" href="/categories/JavaScript/Vue/">Vue</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/15/%E5%AD%A6%E4%B9%A0vuex%E6%BA%90%E7%A0%81/">å­¦ä¹ vuexæºç </a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>è¿™ä¸€ç¯‡ä¸»è¦æ˜¯è®²è§£<code>vuex</code>çš„å¤§æ¦‚å®ç°ï¼Œä»¥åŠä¸€äº›ç»†èŠ‚çš„è¯´æ˜ã€‚</p>
</blockquote>
<h3 id="vuexæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#vuexæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="vuexæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a><code>vuex</code>æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><p>å…ˆä»<code>install</code>æ–¹æ³•çœ‹ï¼Œå®‰è£…æ’ä»¶çš„æ–¹æ³•å®ç°æ¯”è¾ƒç®€å•ï¼Œè°ƒç”¨<code>applyMixin</code>ï¼Œæœ€åæ‰§è¡Œçš„æ˜¯è¿™æ®µé€»è¾‘<code>Vue.mixin(&#123; beforeCreate: vuexInit &#125;)</code>ï¼Œå®é™…ä¸Šæ˜¯åœ¨æ¯ä¸ªç»„ä»¶åˆ›å»ºæ—¶æ··å…¥<code>store</code>å®ä¾‹ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªç»„ä»¶ä¸Šè·å–åˆ°<code>store</code>å®ä¾‹ä¸Šçš„æ•°æ®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">if (version &gt;&#x3D; 2) &#123;</span><br><span class="line">Vue.mixin(&#123; beforeCreate: vuexInit &#125;)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">&#x2F;&#x2F; override init and inject vuex init procedure</span><br><span class="line">&#x2F;&#x2F; for 1.x backwards compatibility.</span><br><span class="line">const _init &#x3D; Vue.prototype._init</span><br><span class="line">Vue.prototype._init &#x3D; function (options &#x3D; &#123;&#125;) &#123;</span><br><span class="line">  options.init &#x3D; options.init</span><br><span class="line">    ? [vuexInit].concat(options.init)</span><br><span class="line">    : vuexInit</span><br><span class="line">  _init.call(this, options)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function vuexInit () &#123;</span><br><span class="line">const options &#x3D; this.$options</span><br><span class="line">&#x2F;&#x2F; store injection</span><br><span class="line">if (options.store) &#123;</span><br><span class="line">  this.$store &#x3D; typeof options.store &#x3D;&#x3D;&#x3D; &#39;function&#39;</span><br><span class="line">    ? options.store()</span><br><span class="line">    : options.store</span><br><span class="line">&#125; else if (options.parent &amp;&amp; options.parent.$store) &#123;</span><br><span class="line">  this.$store &#x3D; options.parent.$store</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function install (_Vue) &#123;</span><br><span class="line">  if (Vue &amp;&amp; _Vue &#x3D;&#x3D;&#x3D; Vue) &#123;</span><br><span class="line">    if (process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39;) &#123;</span><br><span class="line">      console.error(</span><br><span class="line">        &#39;[vuex] already installed. Vue.use(Vuex) should be called only once.&#39;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  Vue &#x3D; _Vue</span><br><span class="line">  applyMixin(Vue)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥çœ‹çœ‹<code>store</code>è¿™ä¸ªç±»çš„ä»£ç ï¼š</p>
<p>åœ¨è¿™ä¸ªç±»ä¸Šæš´éœ²äº†<code>commit</code>å’Œ<code>dispatch</code>æ–¹æ³•ï¼Œå¹¶ä¸”ç»‘å®šäº†è°ƒç”¨ä¸Šä¸‹æ–‡ä¸º<code>store</code>çš„å®ä¾‹ã€‚<code>dispatch</code>æ”¯æŒå¼‚æ­¥æ›´æ–°æ•°æ®æ˜¯å› ä¸ºå®ƒå†…éƒ¨çš„å®ç°å°±æ˜¯ä½¿ç”¨äº†<code>promise</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; bind commit and dispatch to self</span><br><span class="line">const store &#x3D; this</span><br><span class="line">const &#123; dispatch, commit &#125; &#x3D; this</span><br><span class="line">this.dispatch &#x3D; function boundDispatch (type, payload) &#123;</span><br><span class="line">  return dispatch.call(store, type, payload)</span><br><span class="line">&#125;</span><br><span class="line">this.commit &#x3D; function boundCommit (type, payload, options) &#123;</span><br><span class="line">  return commit.call(store, type, payload, options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•æ˜¯<code>vuex</code>çš„å®ç°ä¸»è¦é€»è¾‘ï¼Œ<code>installModule</code>çš„å…·ä½“é€»è¾‘ä¸ç»†è¯´ï¼Œä»æ³¨é‡Šä¸Šæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆå§‹åŒ–æ•´ä¸ª<code>vuex</code>é…ç½®ç”Ÿæˆå¯¹è±¡çš„æ–¹æ³•ã€‚æ ¹æ®é…ç½®è¿›è¡Œé€’å½’æ‰§è¡Œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; init root module.</span><br><span class="line">&#x2F;&#x2F; this also recursively registers all sub-modules</span><br><span class="line">&#x2F;&#x2F; and collects all module getters inside this._wrappedGetters</span><br><span class="line">installModule(this, state, [], this._modules.root)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; initialize the store vm, which is responsible for the reactivity</span><br><span class="line">&#x2F;&#x2F; (also registers _wrappedGetters as computed properties)</span><br><span class="line">resetStoreVM(this, state)</span><br></pre></td></tr></table></figure>

<p><code>resetStoreVM</code>æ–¹æ³•æ¯”è¾ƒé‡è¦ï¼Œä¸‹é¢æ˜¯è¯¥æ–¹æ³•çš„è¯¦ç»†ä»£ç ï¼š</p>
<ol>
<li><code>vuex</code>ä¸­çš„<code>getter</code>å®é™…ä¸Šæ˜¯ä½¿ç”¨<code>vue</code>è®¡ç®—å±æ€§å®ç°çš„ï¼Œ<code>Object.defineProperty</code>é‡Œå®šä¹‰äº†<code>getter</code>çš„<code>get</code>æ–¹æ³•ã€‚</li>
<li><code>store._vm</code>å®é™…å°±æ˜¯<code>vuex</code>æŠŠ<code>installModule</code>ç”Ÿæˆçš„å¯¹è±¡æ”¹é€ æˆå“åº”å¼çš„æ•°æ®ï¼Œé€šè¿‡ä¸€ä¸ªæ–°çš„<code>vue</code>å®ä¾‹ã€‚</li>
<li>æœ€ååˆ™æ˜¯å½“æˆ‘ä»¬é‡ç½®<code>vuex</code>çš„å“åº”æ•°æ®ï¼Œéœ€è¦é”€æ¯æ—§çš„å®ä¾‹ï¼Œå›æ”¶å†…å­˜ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">function resetStoreVM (store, state, hot) &#123;</span><br><span class="line">  const oldVm &#x3D; store._vm</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; bind store public getters</span><br><span class="line">  store.getters &#x3D; &#123;&#125;</span><br><span class="line">  const wrappedGetters &#x3D; store._wrappedGetters</span><br><span class="line">  const computed &#x3D; &#123;&#125;</span><br><span class="line">  forEachValue(wrappedGetters, (fn, key) &#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; use computed to leverage its lazy-caching mechanism</span><br><span class="line">    &#x2F;&#x2F; direct inline function use will lead to closure preserving oldVm.</span><br><span class="line">    &#x2F;&#x2F; using partial to return function with only arguments preserved in closure enviroment.</span><br><span class="line">    computed[key] &#x3D; partial(fn, store)</span><br><span class="line">    Object.defineProperty(store.getters, key, &#123;</span><br><span class="line">      get: () &#x3D;&gt; store._vm[key],</span><br><span class="line">      enumerable: true &#x2F;&#x2F; for local getters</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; use a Vue instance to store the state tree</span><br><span class="line">  &#x2F;&#x2F; suppress warnings just in case the user has added</span><br><span class="line">  &#x2F;&#x2F; some funky global mixins</span><br><span class="line">  const silent &#x3D; Vue.config.silent</span><br><span class="line">  Vue.config.silent &#x3D; true</span><br><span class="line">  store._vm &#x3D; new Vue(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      $$state: state</span><br><span class="line">    &#125;,</span><br><span class="line">    computed</span><br><span class="line">  &#125;)</span><br><span class="line">  Vue.config.silent &#x3D; silent</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; enable strict mode for new vm</span><br><span class="line">  if (store.strict) &#123;</span><br><span class="line">    enableStrictMode(store)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (oldVm) &#123;</span><br><span class="line">    if (hot) &#123;</span><br><span class="line">      &#x2F;&#x2F; dispatch changes in all subscribed watchers</span><br><span class="line">      &#x2F;&#x2F; to force getter re-evaluation for hot reloading.</span><br><span class="line">      store._withCommit(() &#x3D;&gt; &#123;</span><br><span class="line">        oldVm._data.$$state &#x3D; null</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    Vue.nextTick(() &#x3D;&gt; oldVm.$destroy())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹vuexçš„æ•°æ®æ˜¯å¦‚ä½•å“åº”åˆ°è§†å›¾ï¼Ÿ"><a href="#ä¿®æ”¹vuexçš„æ•°æ®æ˜¯å¦‚ä½•å“åº”åˆ°è§†å›¾ï¼Ÿ" class="headerlink" title="ä¿®æ”¹vuexçš„æ•°æ®æ˜¯å¦‚ä½•å“åº”åˆ°è§†å›¾ï¼Ÿ"></a>ä¿®æ”¹<code>vuex</code>çš„æ•°æ®æ˜¯å¦‚ä½•å“åº”åˆ°è§†å›¾ï¼Ÿ</h3><ol>
<li><code>vuex</code>çš„<code>state</code>å’Œ<code>getter</code>å®é™…ä¸Šå°±æ˜¯å¯¹åº”çš„<code>store._vm</code>ï¼ˆ<code>vue</code>å®ä¾‹ï¼‰ä¸­<code>data</code>å’Œ<code>computed</code>ï¼Œå› æ­¤<code>getter</code>æ‰€ä¾èµ–çš„<code>state</code>æœ€åæ˜¯é€šè¿‡<code>watcher</code>ç®¡ç†çš„ã€‚</li>
<li>å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸­ä½¿ç”¨<code>vuex</code>ï¼Œ<code>vuex</code>ç”Ÿæˆçš„å®ä¾‹å¯¹è±¡åœ¨<code>vue</code>å®ä¾‹åŒ–è¿‡ç¨‹ä¸­è¢«æ”¹é€ æˆå“åº”å¼çš„æ•°æ®ï¼Œå½“æˆ‘ä»¬æœ‰å¤šä¸ªé¡µé¢ç»„ä»¶ä½¿ç”¨äº†<code>vuex</code>çš„æ•°æ®ï¼Œå…¶å®ä¹Ÿæ˜¯é€šè¿‡<code>watcher</code>ç®¡ç†ï¼Œå› æ­¤å½“æˆ‘ä»¬ä½¿ç”¨<code>commit</code>æˆ–<code>dispatch</code>ä¿®æ”¹æ•°æ®ï¼Œæœ€åè§¦å‘äº†<code>setter</code>å»é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ï¼ˆ<code>watcher</code>ï¼‰æ›´æ–°ã€‚</li>
</ol>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>vuex</code>çš„è®¾è®¡å…¶å®å¹¶ä¸å¤æ‚ï¼Œç®€å•çš„æ¥è®²ï¼Œå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡å†…éƒ¨çš„æ–¹æ³•ç®¡ç†å†…éƒ¨çš„å±æ€§å’Œè¯»å–å†…éƒ¨çš„å±æ€§ã€‚</p>
<p>è€Œå®ç°çš„è¿‡ç¨‹ï¼Œåˆ™æ˜¯é€šè¿‡ä¸€ç³»åˆ—æ–¹æ³•æŠŠæˆ‘ä»¬çš„é…ç½®ç”Ÿæˆä¸€ä¸ª<code>root</code>å¯¹è±¡ï¼Œç„¶ååˆ©ç”¨<code>vue</code>å®ç°å†…éƒ¨æ•°æ®çš„å“åº”ä¸ä¾èµ–ç®¡ç†ã€‚è€Œè¿™é‡Œæ¯”è¾ƒæ ¸å¿ƒçš„éƒ¨åˆ†åˆ™æ˜¯å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¦‚ä½•å“åº”åˆ°å¯¹åº”çš„è§†å›¾éƒ¨åˆ†ä»¥åŠ<code>getter</code>çš„ä¾èµ–ç®¡ç†ï¼Œè¿™äº›é€»è¾‘çš„å®ç°æœ€åéƒ½æ˜¯é€šè¿‡<code>watcher</code>ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/15/%E5%AD%A6%E4%B9%A0vuex%E6%BA%90%E7%A0%81/" data-id="ckedpbrum000s1zm11ex81lrg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-å­¦ä¹ vueæºç â€”nextTick" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/07/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94nextTick/" class="article-date">
  <time datetime="2019-07-07T14:40:14.000Z" itemprop="datePublished">2019-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>â–º<a class="article-category-link" href="/categories/JavaScript/Vue/">Vue</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/07/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94nextTick/">å­¦ä¹ vueæºç â€”nextTick</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>è¿™ä¸€ç¯‡ä¸»è¦è®²è®²<code>nextTick</code>æºç ï¼Œçœ‹çœ‹è¯¥æ–¹æ³•çš„å®ç°ï¼Œä»¥åŠä¸ºä½•èƒ½åœ¨è¿™ä¸ªæ–¹æ³•é‡Œä¿è¯æ‹¿åˆ°<code>DOM</code>èŠ‚ç‚¹ã€‚</p>
</blockquote>
<p><code>nextTick</code>æ–¹æ³•åœ¨<code>./src/core/util/next-tick.js</code>ï¼Œä¸‹é¢ä¸ºéƒ¨åˆ†æºç å±•ç¤ºï¼š</p>
<ol>
<li><code>nextTick</code>æ–¹æ³•æ¥å—ä¸¤ä¸ªå…¥å‚ï¼Œåˆ†åˆ«æ˜¯å›è°ƒæ–¹æ³•<code>cb</code>å’Œä¸Šä¸‹æ–‡<code>ctx</code>;</li>
<li>å‡½æ•°éƒ¨åˆ†é€»è¾‘ï¼Œé¦–å…ˆä¸ç®¡æ˜¯å¦å­˜åœ¨<code>cb</code>å‚æ•°éƒ½ä¼šå¾€é˜Ÿåˆ—æ¨å…¥ä¸€ä¸ªå‡½æ•°ï¼Œåç»­ä»»åŠ¡é˜Ÿåˆ—æ ¹æ®<code>cb</code>å‚æ•°åˆ¤æ–­æ˜¯å¦è°ƒç”¨<code>cb</code>æˆ–è€…æ˜¯å¦æ‰§è¡Œ<code>_resolve(ctx)</code>ä¿®æ”¹<code>promise</code>çŠ¶æ€ï¼›</li>
<li>åˆ¤æ–­<code>pending</code>çŠ¶æ€æ˜¯å¦æ‰§è¡Œä»»åŠ¡</li>
<li>æœ€ååˆ™æ˜¯è¯¥å‡½æ•°çš„è¿”å›å€¼ä¸ºä¸€ä¸ª<code>promise</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">export function nextTick (cb?: Function, ctx?: Object) &#123;</span><br><span class="line">  let _resolve</span><br><span class="line">  callbacks.push(() &#x3D;&gt; &#123;</span><br><span class="line">    if (cb) &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        cb.call(ctx)</span><br><span class="line">      &#125; catch (e) &#123;</span><br><span class="line">        handleError(e, ctx, &#39;nextTick&#39;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else if (_resolve) &#123;</span><br><span class="line">      _resolve(ctx)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  if (!pending) &#123;</span><br><span class="line">    pending &#x3D; true</span><br><span class="line">    timerFunc()</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;&#x2F; $flow-disable-line</span><br><span class="line">  if (!cb &amp;&amp; typeof Promise !&#x3D;&#x3D; &#39;undefined&#39;) &#123;</span><br><span class="line">    return new Promise(resolve &#x3D;&gt; &#123;</span><br><span class="line">      _resolve &#x3D; resolve</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆæ¥è¯´è¯´è°ƒç”¨<code>nextTick</code>çš„è¿”å›å€¼ï¼Œå› ä¸ºè¿”å›å€¼æ˜¯ä¸€ä¸ª<code>promise</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>then</code>çš„å†™æ³•æˆ–è€…<code>async/await</code>çš„å†™æ³•ï¼ŒåŠ ä¸Šä½¿ç”¨<code>cb</code>çš„å†™æ³•ï¼Œå­˜åœ¨ä¸‰ç§å†™æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">this.$nextTick(function() &#123;</span><br><span class="line">    &#x2F;&#x2F; do something</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">this.$nextTick().then((ctx)&#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; do something</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">await this.$nextTick()</span><br><span class="line">&#x2F;&#x2F; do something</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥åˆ™æ˜¯<code>nextTick</code>é‡Œæ¯”è¾ƒé‡è¦çš„æ–¹æ³•<code>timerFunc</code>çš„å®ç°ï¼š</p>
<ol>
<li>ä¼˜å…ˆä½¿ç”¨åŸç”Ÿ<code>Promise</code>ï¼›</li>
<li>åä½¿ç”¨<code>MutationObserver</code>ï¼›</li>
<li>å†åä½¿ç”¨<code>setImmediate</code>;</li>
<li>æœ€åä½¿ç”¨<code>setTimeout</code>;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">if (typeof Promise !&#x3D;&#x3D; &#39;undefined&#39; &amp;&amp; isNative(Promise)) &#123;</span><br><span class="line">  const p &#x3D; Promise.resolve()</span><br><span class="line">  timerFunc &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    p.then(flushCallbacks)</span><br><span class="line">    &#x2F;&#x2F; In problematic UIWebViews, Promise.then doesn&#39;t completely break, but</span><br><span class="line">    &#x2F;&#x2F; it can get stuck in a weird state where callbacks are pushed into the</span><br><span class="line">    &#x2F;&#x2F; microtask queue but the queue isn&#39;t being flushed, until the browser</span><br><span class="line">    &#x2F;&#x2F; needs to do some other work, e.g. handle a timer. Therefore we can</span><br><span class="line">    &#x2F;&#x2F; &quot;force&quot; the microtask queue to be flushed by adding an empty timer.</span><br><span class="line">    if (isIOS) setTimeout(noop)</span><br><span class="line">  &#125;</span><br><span class="line">  isUsingMicroTask &#x3D; true</span><br><span class="line">&#125; else if (!isIE &amp;&amp; typeof MutationObserver !&#x3D;&#x3D; &#39;undefined&#39; &amp;&amp; (</span><br><span class="line">  isNative(MutationObserver) ||</span><br><span class="line">  &#x2F;&#x2F; PhantomJS and iOS 7.x</span><br><span class="line">  MutationObserver.toString() &#x3D;&#x3D;&#x3D; &#39;[object MutationObserverConstructor]&#39;</span><br><span class="line">)) &#123;</span><br><span class="line">  &#x2F;&#x2F; Use MutationObserver where native Promise is not available,</span><br><span class="line">  &#x2F;&#x2F; e.g. PhantomJS, iOS7, Android 4.4</span><br><span class="line">  &#x2F;&#x2F; (#6466 MutationObserver is unreliable in IE11)</span><br><span class="line">  let counter &#x3D; 1</span><br><span class="line">  const observer &#x3D; new MutationObserver(flushCallbacks)</span><br><span class="line">  const textNode &#x3D; document.createTextNode(String(counter))</span><br><span class="line">  observer.observe(textNode, &#123;</span><br><span class="line">    characterData: true</span><br><span class="line">  &#125;)</span><br><span class="line">  timerFunc &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    counter &#x3D; (counter + 1) % 2</span><br><span class="line">    textNode.data &#x3D; String(counter)</span><br><span class="line">  &#125;</span><br><span class="line">  isUsingMicroTask &#x3D; true</span><br><span class="line">&#125; else if (typeof setImmediate !&#x3D;&#x3D; &#39;undefined&#39; &amp;&amp; isNative(setImmediate)) &#123;</span><br><span class="line">  &#x2F;&#x2F; Fallback to setImmediate.</span><br><span class="line">  &#x2F;&#x2F; Techinically it leverages the (macro) task queue,</span><br><span class="line">  &#x2F;&#x2F; but it is still a better choice than setTimeout.</span><br><span class="line">  timerFunc &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    setImmediate(flushCallbacks)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  &#x2F;&#x2F; Fallback to setTimeout.</span><br><span class="line">  timerFunc &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    setTimeout(flushCallbacks, 0)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä»£ç ä¸­<code>isUsingMicroTask</code>ä¸­å¯ä»¥çœ‹åˆ°åªæœ‰<code>Promise</code>ã€<code>MutationObserver</code>å±äºå¾®ä»»åŠ¡ï¼Œå¦å¤–ä¸¤ä¸ªåˆ™å±äºå®ä»»åŠ¡ï¼›çœ‹åˆ°è¯¥æ–¹æ³•çš„å®ç°æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ä¸ºä»€ä¹ˆåœ¨<code>nextTick</code>æ–¹æ³•ä¸­èƒ½ä¿è¯æ‹¿åˆ°<code>DOM</code>ã€‚</p>
<p>ä¸¤ç§åœºæ™¯çš„è§£é‡Šï¼š</p>
<ol>
<li>åœ¨<code>vue</code>ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨<code>beforeCreated</code>å’Œ<code>created</code>ç”Ÿå‘½å‘¨æœŸé‡Œæƒ³è¦ä½¿ç”¨<code>DOM</code>åˆ™å¿…é¡»ä½¿ç”¨<code>nextTick</code>ï¼Œè¿™æ˜¯å› ä¸ºåˆå§‹åŒ–çš„è¿‡ç¨‹å±äºå®ä»»åŠ¡ï¼Œæ•´ä¸ªå‡½æ•°è°ƒç”¨æ ˆæœªæ¸…ç©ºï¼Œ<code>nextTick</code>çš„å›è°ƒå±äºå¾®ä»»åŠ¡ï¼Œæ‰€ä»¥<code>nextTick</code>çš„å›è°ƒå¿…é¡»åœ¨æ•´ä¸ªåˆå§‹åŒ–ç»“æŸåæ‰ä¼šæ‰§è¡Œã€‚</li>
<li>åœ¨ä¿®æ”¹<code>data</code>æ•°æ®åï¼Œåˆå¦‚ä½•ä¿è¯è·å–ä¿®æ”¹åçš„æ•°æ®<code>DOM</code>ï¼Ÿä¿®æ”¹<code>data</code>æ•°æ®å®é™…ä¸Šæ˜¯è§¦å‘ç»„ä»¶å®ä¾‹çš„<code>watcher</code>æ‰§è¡Œ<code>update</code>æ›´æ–°ï¼Œè€Œåœ¨<code>update</code>é‡Œé¢åˆæ‰§è¡Œäº†<code>queueWatcher</code>ï¼Œä¸‹é¢ğŸ‘‡åˆ™æ˜¯<code>queueWatcher</code>æ–¹æ³•çš„ä»£ç ï¼Œåœ¨ä»£ç é‡Œé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€åå®é™…ä¸Šä¹Ÿæ˜¯è°ƒç”¨<code>nextTick(flushSchedulerQueue)</code>ã€‚å› æ­¤ï¼Œæƒ³è·å–<code>data</code>ä¿®æ”¹åçš„<code>DOM</code>ï¼Œè°ƒç”¨<code>nextTick</code>èƒ½ä¿è¯è¿™ç§ä»»åŠ¡æ‰§è¡Œçš„é¡ºåºã€‚</li>
</ol>
<p>äº†è§£<code>watcher</code>å¯ä»¥çœ‹è¿™ç¯‡<a target="_blank" rel="noopener" href="https://juejin.im/post/5d181bafe51d457753138219">https://juejin.im/post/5d181bafe51d457753138219</a>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">export function queueWatcher (watcher: Watcher) &#123;</span><br><span class="line">  const id &#x3D; watcher.id</span><br><span class="line">  if (has[id] &#x3D;&#x3D; null) &#123;</span><br><span class="line">    has[id] &#x3D; true</span><br><span class="line">    if (!flushing) &#123;</span><br><span class="line">      queue.push(watcher)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      &#x2F;&#x2F; if already flushing, splice the watcher based on its id</span><br><span class="line">      &#x2F;&#x2F; if already past its id, it will be run next immediately.</span><br><span class="line">      let i &#x3D; queue.length - 1</span><br><span class="line">      while (i &gt; index &amp;&amp; queue[i].id &gt; watcher.id) &#123;</span><br><span class="line">        i--</span><br><span class="line">      &#125;</span><br><span class="line">      queue.splice(i + 1, 0, watcher)</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; queue the flush</span><br><span class="line">    if (!waiting) &#123;</span><br><span class="line">      waiting &#x3D; true</span><br><span class="line"></span><br><span class="line">      if (process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39; &amp;&amp; !config.async) &#123;</span><br><span class="line">        flushSchedulerQueue()</span><br><span class="line">        return</span><br><span class="line">      &#125;</span><br><span class="line">      nextTick(flushSchedulerQueue)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®<code>queueWatcher</code>æ–¹æ³•é‡Œé¢çš„é€»è¾‘è¿˜å‘Šè¯‰äº†æˆ‘ä»¬å¦å¤–ä¸€ä¸ªæ¡†æ¶çŸ¥è¯†ç‚¹ï¼š</p>
<p><strong>ä¸ºä»€ä¹ˆæˆ‘ä»¬åŒæ—¶ä¿®æ”¹å¤šä¸ªdataå±æ€§ï¼Œä¸ä¼šå¤šæ¬¡æ›´æ–°è§†å›¾ï¼Ÿ</strong></p>
<p>åœ¨<code>update</code>æ–¹æ³•é‡Œï¼Œå› ä¸ºæœ€åå®é™…ä¸Šè°ƒç”¨<code>nextTick</code>æ‰§è¡Œå¾®ä»»åŠ¡å»æ›´æ–°è§†å›¾ï¼Œäº†è§£è¿‡<code>event loop</code>æœºåˆ¶çš„åº”è¯¥çŸ¥é“ï¼Œå¿…é¡»ç­‰å¾…å½“å‰å®ä»»åŠ¡çš„è°ƒç”¨æ ˆæ¸…ç©ºæ‰å»æ‰§è¡Œå¾®ä»»åŠ¡ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬åŒæ—¶ä¿®æ”¹å¤šä¸ª<code>data</code>å±æ€§æ—¶å€™ï¼Œè¯¥åˆ¤æ–­<code>if (has[id] == null) </code>é˜²æ­¢é‡å¤æ·»åŠ æ›´æ–°ä»»åŠ¡ï¼Œå¹¶ä¸”åˆ©ç”¨äº†<code>event loop</code>æœºåˆ¶åœ¨åˆé€‚çš„æ—¶æœºå»æ›´æ–°è§†å›¾ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/07/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94nextTick/" data-id="ckedpbruq000z1zm10bms81q9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-å­¦ä¹ vueæºç â€”mvvm" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/30/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94mvvm/" class="article-date">
  <time datetime="2019-06-30T14:43:12.000Z" itemprop="datePublished">2019-06-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>â–º<a class="article-category-link" href="/categories/JavaScript/Vue/">Vue</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/30/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94mvvm/">å­¦ä¹ vueæºç â€”mvvm</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>è¿™ä¸€ç¯‡ä¸»è¦æ˜¯è®²è§£ä¸€ä¸‹vueé‡Œmvvmçš„åŸç†ï¼Œä»¥åŠå¦‚ä½•ç†è§£vueå®ç°mvvmã€‚</p>
</blockquote>
<p>ç¨å¾®æœ‰å»äº†è§£è¿‡vueæ˜¯å¦‚ä½•åŒå‘ç»‘å®šçš„æˆ‘ä»¬éƒ½å¾ˆå®¹æ˜“çŸ¥é“vueæ˜¯é€šè¿‡<code>Object.defineProperty</code>åŠ«æŒ<code>data</code>å±æ€§çš„<code>setter</code>å’Œ<code>getter</code>ï¼Œä½†æ˜¯è¿™ä»…ä»…åªæ˜¯å®ç°çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è¿™ä¸ªå®ç°é‡Œæˆ‘ä»¬è¿˜è¦ç†è§£<code>dep</code>ï¼ˆè®¢é˜…ä¸­å¿ƒï¼‰å’Œ<code>watcher</code>ï¼ˆè®¢é˜…è€…ï¼‰çš„æ¦‚å¿µã€‚</p>
<h3 id="depâ€”è®¢é˜…ä¸­å¿ƒ"><a href="#depâ€”è®¢é˜…ä¸­å¿ƒ" class="headerlink" title="depâ€”è®¢é˜…ä¸­å¿ƒ"></a><code>dep</code>â€”è®¢é˜…ä¸­å¿ƒ</h3><p><code>dep</code>ä»£ç åœ¨<code>./src/core/observer/dep.js</code>æ–‡ä»¶é‡Œï¼Œä¸‹é¢ç®€å•è®²è§£ä¸€ä¸‹ï¼š</p>
<ol>
<li><code>dep</code>çš„å®šä¹‰å‚è€ƒäº†è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼ï¼Œæ¯ä¸€ä¸ª<code>dep</code>æœ‰è‡ªå·±çš„å”¯ä¸€æ ‡è¯†<code>id</code>å’Œè®¢é˜…è€…åˆ—è¡¨<code>subs</code>ã€‚</li>
<li><code>addSub</code>å’Œ<code>removeSub</code>ç”¨æ¥ç®¡ç†è®¢é˜…è€…åˆ—è¡¨<code>subs</code>ã€‚</li>
<li><code>depend</code>ç”¨æ¥æ”¶é›†<code>watcher</code>ï¼ˆè®¢é˜…è€…ï¼‰ã€‚</li>
<li><code>notify</code>ç”¨æ¥é€šçŸ¥<code>watcher</code>ï¼ˆè®¢é˜…è€…ï¼‰æ‰§è¡Œæ›´æ–°ã€‚</li>
<li><code>Dep.target</code>åˆšå¼€å§‹çœ‹æ˜¯æ¯”è¾ƒéš¾ç†è§£çš„ä¸€ä¸ªæ¦‚å¿µï¼Œ<code>Dep.target</code>å…¶å®æ˜¯è°ƒç”¨å½“å‰<code>dep</code>å¯¹åº”å±æ€§çš„<code>watcher</code>ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚<code>data</code>æœ‰ä¸ªå±æ€§<code>name</code>ï¼Œé‚£ä¹ˆå½“<code>data.name</code>çš„<code>getter</code>è¢«è§¦å‘æ—¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ˜¯è°åœ¨è°ƒç”¨è¿™ä¸ª<code>data.name</code>çš„<code>getter</code>ï¼Œè¿™å°±æ˜¯<code>Dep.target</code>ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">export default class Dep &#123;</span><br><span class="line">  static target: ?Watcher;</span><br><span class="line">  id: number;</span><br><span class="line">  subs: Array&lt;Watcher&gt;;</span><br><span class="line"></span><br><span class="line">  constructor () &#123;</span><br><span class="line">    this.id &#x3D; uid++</span><br><span class="line">    this.subs &#x3D; []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addSub (sub: Watcher) &#123;</span><br><span class="line">    this.subs.push(sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  removeSub (sub: Watcher) &#123;</span><br><span class="line">    remove(this.subs, sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  depend () &#123;</span><br><span class="line">    if (Dep.target) &#123;</span><br><span class="line">      Dep.target.addDep(this)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  notify () &#123;</span><br><span class="line">    &#x2F;&#x2F; stabilize the subscriber list first</span><br><span class="line">    const subs &#x3D; this.subs.slice()</span><br><span class="line">    if (process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39; &amp;&amp; !config.async) &#123;</span><br><span class="line">      &#x2F;&#x2F; subs aren&#39;t sorted in scheduler if not running async</span><br><span class="line">      &#x2F;&#x2F; we need to sort them now to make sure they fire in correct</span><br><span class="line">      &#x2F;&#x2F; order</span><br><span class="line">      subs.sort((a, b) &#x3D;&gt; a.id - b.id)</span><br><span class="line">    &#125;</span><br><span class="line">    for (let i &#x3D; 0, l &#x3D; subs.length; i &lt; l; i++) &#123;</span><br><span class="line">      subs[i].update()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; The current target watcher being evaluated.</span><br><span class="line">&#x2F;&#x2F; This is globally unique because only one watcher</span><br><span class="line">&#x2F;&#x2F; can be evaluated at a time.</span><br><span class="line">Dep.target &#x3D; null</span><br><span class="line">const targetStack &#x3D; []</span><br><span class="line"></span><br><span class="line">export function pushTarget (target: ?Watcher) &#123;</span><br><span class="line">  targetStack.push(target)</span><br><span class="line">  Dep.target &#x3D; target</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function popTarget () &#123;</span><br><span class="line">  targetStack.pop()</span><br><span class="line">  Dep.target &#x3D; targetStack[targetStack.length - 1]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="watcherâ€”è®¢é˜…è€…"><a href="#watcherâ€”è®¢é˜…è€…" class="headerlink" title="watcherâ€”è®¢é˜…è€…"></a><code>watcher</code>â€”è®¢é˜…è€…</h3><p><code>watcher</code>ä»£ç åœ¨<code>./src/core/observer/watcher.js</code>æ–‡ä»¶é‡Œï¼Œå…³äº<code>watcher</code>çš„é€‰é¡¹é…ç½®å°±ä¸ç»†è¯´äº†ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªéœ€è¦é‡ç‚¹å…³æ³¨å…¶ä¸­çš„<code>get</code><br>ã€<code>update</code>ã€<code>run</code>ã€<code>evaluate</code>è¿™å‡ ä¸ªæ–¹æ³•ã€‚</p>
<p>è¿™å‡ ä¸ªæ–¹æ³•çš„ä½œç”¨ç¨åè§£é‡Šï¼Œç°åœ¨æˆ‘ä»¬è¦å…ˆç†è§£æ€æ ·æ‰ä¼šäº§ç”Ÿä¸€ä¸ª<code>watcher</code>ã€‚åœ¨vueé‡Œé¢ï¼Œæœ‰ä¸‰ç§ç±»å‹çš„<code>watcher</code>ï¼š</p>
<ol>
<li>æ¯ä¸€ä¸ªç»„ä»¶çš„å®ä¾‹éƒ½æ˜¯ä¸€ä¸ª<code>watcher</code></li>
<li>åœ¨ç»„ä»¶çš„<code>watch</code>é€‰é¡¹ä¸­å£°æ˜çš„<code>watcher</code></li>
<li>è®¡ç®—å±æ€§æ‰€ä½¿ç”¨çš„ä¾èµ–å€¼ä¼šç»™å¯¹åº”çš„ä¾èµ–å€¼æ·»åŠ ä¸€ä¸ª<code>watcher</code></li>
</ol>
<p>è®²å®Œ<code>watcher</code>çš„æ¥æºåæˆ‘ä»¬å†æ¥çœ‹è¿™å‡ ä¸ªæ–¹æ³•çš„è®²è§£ï¼š</p>
<ol>
<li>å…ˆä»<code>update</code>è®²èµ·ï¼Œå½“æŸä¸ªå“åº”å±æ€§å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘<code>setter</code>åï¼Œæ‰§è¡Œ<code>dep.notify</code>é€šçŸ¥æ¯ä¸ª<code>watcher</code>æ‰§è¡Œ<code>update</code>ï¼Œä»£ç æ¯”è¾ƒç®€å•ï¼Œä¸‰ä¸ªé€»è¾‘åˆ†æ”¯ï¼Œåˆ¤æ–­<code>this.lazy</code>ï¼Œè¿™æ˜¯åº”ç”¨äº<font color=red>è®¡ç®—å±æ€§</font>æ—¶ä¼šè§¦å‘çš„é€»è¾‘åˆ†æ”¯ï¼Œ<code>this.sync<br></code>åˆ™ç”¨äºåˆ¤æ–­åŒæ­¥æ‰§è¡Œ<code>watcher</code>çš„å›è°ƒï¼Œå¦åˆ™æ¨å…¥<code>queueWatcher</code>åç»­æ‰§è¡Œã€‚</li>
<li><code>run</code>å’Œ<code>evaluate</code>éƒ½æ˜¯ä¼šè°ƒç”¨<code>get</code>æ–¹æ³•ï¼Œåªæ˜¯<code>run</code>æ–¹æ³•æ˜¯ç”¨äºç»„ä»¶å®ä¾‹çš„<code>watcher</code>å’Œ<code>watch</code>é€‰é¡¹ä¸­å£°æ˜çš„<code>watcher</code>ï¼Œ<code>watch</code>é€‰é¡¹ä¸­å£°æ˜çš„<code>watcher</code>çš„<code>this.user</code>ä¸º<code>true</code>ï¼Œåœ¨<code>run</code>æ–¹æ³•ä¸­çš„<code>this.cb.call(this.vm, value, oldValue)</code>è¿™æ®µä»£ç åˆ™æ˜¯æˆ‘ä»¬<code>watch</code>é€‰é¡¹ä¸­è§¦å‘çš„å›è°ƒã€‚è‡³äº<code>evaluate</code>æ–¹æ³•åˆ™æ›´åŠ ç®€å•äº†ï¼Œè°ƒç”¨<code>get</code>æ–¹æ³•ç„¶åè®¾ç½®<code>this.dirty</code>ä¸º<code>false</code>åˆ™æ˜¯ä¸ºäº†åç»­å…¶ä»–åœ°æ–¹ä½¿ç”¨è¿™ä¸ªè®¡ç®—å±æ€§çš„æ—¶å€™ä¸éœ€è¦é‡æ–°è®¡ç®—ï¼Œè¿™ä¹Ÿæ˜¯<font color=red>è®¡ç®—å±æ€§ç¼“å­˜</font>çš„ä¸€éƒ¨åˆ†é€»è¾‘ã€‚</li>
<li>æ¥ä¸‹æ¥è®²è®²<code>get</code>æ–¹æ³•ï¼Œ<code>pushTarget(this)</code>è¿™æ®µåˆ™æ˜¯è®¾ç½®<code>Dep.target</code>ä¸ºå½“å‰<code>watcher</code>å®ä¾‹ï¼Œå…¶å®å°±æ˜¯å‘Šè¯‰<code>dep</code>æ˜¯è°åœ¨è·å–å±æ€§ã€‚<code>value = this.getter.call(vm, vm)</code>åˆ™æ˜¯è·å–å½“å‰å€¼ï¼Œåœ¨è¿™é‡Œä¸‰ç§ç±»å‹çš„<code>watcher</code>çš„<code>getter</code>æ˜¯ä¸ä¸€æ ·çš„ã€‚</li>
<li>æœ€åæä¸€ä¸‹ï¼Œè®¡ç®—å±æ€§çš„å€¼ä¸€èˆ¬æ˜¯åœ¨ç»„ä»¶å®ä¾‹çš„<code>watcher</code>æ‰§è¡Œ<code>getter</code>çš„è¿‡ç¨‹ä¸­æ‰§è¡Œè®¡ç®—çš„ã€‚</li>
</ol>
<table>
<thead>
<tr>
<th>watcherç±»å‹</th>
<th>getter</th>
</tr>
</thead>
<tbody><tr>
<td>ç»„ä»¶å®ä¾‹</td>
<td>renderå‡½æ•°</td>
</tr>
<tr>
<td>watch</td>
<td>æ‰§è¡ŒparsePathæ–¹æ³•ç”Ÿæˆçš„å‡½æ•°</td>
</tr>
<tr>
<td>è®¡ç®—å±æ€§</td>
<td>æ‰§è¡ŒcreateComputedGetteræ–¹æ³•ç”Ÿæˆçš„å‡½æ•°</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">export default class Watcher &#123;</span><br><span class="line">  vm: Component;</span><br><span class="line">  expression: string;</span><br><span class="line">  cb: Function;</span><br><span class="line">  id: number;</span><br><span class="line">  deep: boolean;</span><br><span class="line">  user: boolean;</span><br><span class="line">  lazy: boolean;</span><br><span class="line">  sync: boolean;</span><br><span class="line">  dirty: boolean;</span><br><span class="line">  active: boolean;</span><br><span class="line">  deps: Array&lt;Dep&gt;;</span><br><span class="line">  newDeps: Array&lt;Dep&gt;;</span><br><span class="line">  depIds: SimpleSet;</span><br><span class="line">  newDepIds: SimpleSet;</span><br><span class="line">  before: ?Function;</span><br><span class="line">  getter: Function;</span><br><span class="line">  value: any;</span><br><span class="line"></span><br><span class="line">  constructor (</span><br><span class="line">    vm: Component,</span><br><span class="line">    expOrFn: string | Function,</span><br><span class="line">    cb: Function,</span><br><span class="line">    options?: ?Object,</span><br><span class="line">    isRenderWatcher?: boolean</span><br><span class="line">  ) &#123;</span><br><span class="line">    this.vm &#x3D; vm</span><br><span class="line">    if (isRenderWatcher) &#123;</span><br><span class="line">      vm._watcher &#x3D; this</span><br><span class="line">    &#125;</span><br><span class="line">    vm._watchers.push(this)</span><br><span class="line">    &#x2F;&#x2F; options</span><br><span class="line">    if (options) &#123;</span><br><span class="line">      this.deep &#x3D; !!options.deep</span><br><span class="line">      this.user &#x3D; !!options.user</span><br><span class="line">      this.lazy &#x3D; !!options.lazy</span><br><span class="line">      this.sync &#x3D; !!options.sync</span><br><span class="line">      this.before &#x3D; options.before</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      this.deep &#x3D; this.user &#x3D; this.lazy &#x3D; this.sync &#x3D; false</span><br><span class="line">    &#125;</span><br><span class="line">    this.cb &#x3D; cb</span><br><span class="line">    this.id &#x3D; ++uid &#x2F;&#x2F; uid for batching</span><br><span class="line">    this.active &#x3D; true</span><br><span class="line">    this.dirty &#x3D; this.lazy &#x2F;&#x2F; for lazy watchers</span><br><span class="line">    this.deps &#x3D; []</span><br><span class="line">    this.newDeps &#x3D; []</span><br><span class="line">    this.depIds &#x3D; new Set()</span><br><span class="line">    this.newDepIds &#x3D; new Set()</span><br><span class="line">    this.expression &#x3D; process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39;</span><br><span class="line">      ? expOrFn.toString()</span><br><span class="line">      : &#39;&#39;</span><br><span class="line">    &#x2F;&#x2F; parse expression for getter</span><br><span class="line">    if (typeof expOrFn &#x3D;&#x3D;&#x3D; &#39;function&#39;) &#123;</span><br><span class="line">      this.getter &#x3D; expOrFn</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      this.getter &#x3D; parsePath(expOrFn)</span><br><span class="line">      if (!this.getter) &#123;</span><br><span class="line">        this.getter &#x3D; noop</span><br><span class="line">        process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39; &amp;&amp; warn(</span><br><span class="line">          &#96;Failed watching path: &quot;$&#123;expOrFn&#125;&quot; &#96; +</span><br><span class="line">          &#39;Watcher only accepts simple dot-delimited paths. &#39; +</span><br><span class="line">          &#39;For full control, use a function instead.&#39;,</span><br><span class="line">          vm</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    this.value &#x3D; this.lazy</span><br><span class="line">      ? undefined</span><br><span class="line">      : this.get()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Evaluate the getter, and re-collect dependencies.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  get () &#123;</span><br><span class="line">    pushTarget(this)</span><br><span class="line">    let value</span><br><span class="line">    const vm &#x3D; this.vm</span><br><span class="line">    try &#123;</span><br><span class="line">      value &#x3D; this.getter.call(vm, vm)</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      if (this.user) &#123;</span><br><span class="line">        handleError(e, vm, &#96;getter for watcher &quot;$&#123;this.expression&#125;&quot;&#96;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        throw e</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">      &#x2F;&#x2F; &quot;touch&quot; every property so they are all tracked as</span><br><span class="line">      &#x2F;&#x2F; dependencies for deep watching</span><br><span class="line">      if (this.deep) &#123;</span><br><span class="line">        traverse(value)</span><br><span class="line">      &#125;</span><br><span class="line">      popTarget()</span><br><span class="line">      this.cleanupDeps()</span><br><span class="line">    &#125;</span><br><span class="line">    return value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Add a dependency to this directive.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  addDep (dep: Dep) &#123;</span><br><span class="line">    const id &#x3D; dep.id</span><br><span class="line">    if (!this.newDepIds.has(id)) &#123;</span><br><span class="line">      this.newDepIds.add(id)</span><br><span class="line">      this.newDeps.push(dep)</span><br><span class="line">      if (!this.depIds.has(id)) &#123;</span><br><span class="line">        dep.addSub(this)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Clean up for dependency collection.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  cleanupDeps () &#123;</span><br><span class="line">    let i &#x3D; this.deps.length</span><br><span class="line">    while (i--) &#123;</span><br><span class="line">      const dep &#x3D; this.deps[i]</span><br><span class="line">      if (!this.newDepIds.has(dep.id)) &#123;</span><br><span class="line">        dep.removeSub(this)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    let tmp &#x3D; this.depIds</span><br><span class="line">    this.depIds &#x3D; this.newDepIds</span><br><span class="line">    this.newDepIds &#x3D; tmp</span><br><span class="line">    this.newDepIds.clear()</span><br><span class="line">    tmp &#x3D; this.deps</span><br><span class="line">    this.deps &#x3D; this.newDeps</span><br><span class="line">    this.newDeps &#x3D; tmp</span><br><span class="line">    this.newDeps.length &#x3D; 0</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Subscriber interface.</span><br><span class="line">   * Will be called when a dependency changes.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  update () &#123;</span><br><span class="line">    &#x2F;* istanbul ignore else *&#x2F;</span><br><span class="line">    if (this.lazy) &#123;</span><br><span class="line">      this.dirty &#x3D; true</span><br><span class="line">    &#125; else if (this.sync) &#123;</span><br><span class="line">      this.run()</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      queueWatcher(this)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Scheduler job interface.</span><br><span class="line">   * Will be called by the scheduler.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  run () &#123;</span><br><span class="line">    if (this.active) &#123;</span><br><span class="line">      const value &#x3D; this.get()</span><br><span class="line">      if (</span><br><span class="line">        value !&#x3D;&#x3D; this.value ||</span><br><span class="line">        &#x2F;&#x2F; Deep watchers and watchers on Object&#x2F;Arrays should fire even</span><br><span class="line">        &#x2F;&#x2F; when the value is the same, because the value may</span><br><span class="line">        &#x2F;&#x2F; have mutated.</span><br><span class="line">        isObject(value) ||</span><br><span class="line">        this.deep</span><br><span class="line">      ) &#123;</span><br><span class="line">        &#x2F;&#x2F; set new value</span><br><span class="line">        const oldValue &#x3D; this.value</span><br><span class="line">        this.value &#x3D; value</span><br><span class="line">        if (this.user) &#123;</span><br><span class="line">          try &#123;</span><br><span class="line">            this.cb.call(this.vm, value, oldValue)</span><br><span class="line">          &#125; catch (e) &#123;</span><br><span class="line">            handleError(e, this.vm, &#96;callback for watcher &quot;$&#123;this.expression&#125;&quot;&#96;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.cb.call(this.vm, value, oldValue)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Evaluate the value of the watcher.</span><br><span class="line">   * This only gets called for lazy watchers.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  evaluate () &#123;</span><br><span class="line">    this.value &#x3D; this.get()</span><br><span class="line">    this.dirty &#x3D; false</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Depend on all deps collected by this watcher.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  depend () &#123;</span><br><span class="line">    let i &#x3D; this.deps.length</span><br><span class="line">    while (i--) &#123;</span><br><span class="line">      this.deps[i].depend()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Remove self from all dependencies&#39; subscriber list.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  teardown () &#123;</span><br><span class="line">    if (this.active) &#123;</span><br><span class="line">      &#x2F;&#x2F; remove self from vm&#39;s watcher list</span><br><span class="line">      &#x2F;&#x2F; this is a somewhat expensive operation so we skip it</span><br><span class="line">      &#x2F;&#x2F; if the vm is being destroyed.</span><br><span class="line">      if (!this.vm._isBeingDestroyed) &#123;</span><br><span class="line">        remove(this.vm._watchers, this)</span><br><span class="line">      &#125;</span><br><span class="line">      let i &#x3D; this.deps.length</span><br><span class="line">      while (i--) &#123;</span><br><span class="line">        this.deps[i].removeSub(this)</span><br><span class="line">      &#125;</span><br><span class="line">      this.active &#x3D; false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å…¶å®å­¦ä¹ vueçš„mvvmï¼Œé‡ç‚¹åœ¨äº<code>dep</code>å’Œ<code>watcher</code>çš„ç†è§£ï¼Œè¦æ˜ç™½è¿™ä¸¤ä¸ªç±»çš„å®ä¾‹åœ¨åŒå‘ç»‘å®šçš„è¿‡ç¨‹ä¸­æ‰®æ¼”çš„æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·è§’è‰²ï¼Œå•çº¯ä»ä»£ç ä¸Šå¯èƒ½ä¸å¤ªå®¹æ˜“ç†è§£è¿™æ ·è®¾è®¡çš„æ„å›¾ï¼Œä½†æ˜¯å¦‚æœèƒ½æœ‰ä¸€ä¸ªæ¯”è¾ƒå…·è±¡åŒ–çš„ä¸œè¥¿æ¥å¯¹åº”ï¼Œç›¸ä¿¡å¯¹ä½ çš„ç†è§£ä¼šæœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/30/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94mvvm/" data-id="ckedpbrup000w1zm1bccs8iv3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-å­¦ä¹ vueæºç â€”vue-diff" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/23/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94vue-diff/" class="article-date">
  <time datetime="2019-06-23T14:40:48.000Z" itemprop="datePublished">2019-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>â–º<a class="article-category-link" href="/categories/JavaScript/Vue/">Vue</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/23/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94vue-diff/">å­¦ä¹ vueæºç â€”vue-diff</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>æœ¬æ–‡ä¸»è¦è®°å½•vue-diffçš„åŸç†ä»¥åŠè¯´æ˜ä¸€ä¸ªå“åº”å¼æ•°æ®æ›´æ–°çš„æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚</p>
</blockquote>
<h2 id="1-æ•°æ®æ”¹å˜åˆ°é¡µé¢æ¸²æŸ“çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ"><a href="#1-æ•°æ®æ”¹å˜åˆ°é¡µé¢æ¸²æŸ“çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ" class="headerlink" title="1. æ•°æ®æ”¹å˜åˆ°é¡µé¢æ¸²æŸ“çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ"></a>1. æ•°æ®æ”¹å˜åˆ°é¡µé¢æ¸²æŸ“çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</h2><p>é¦–å…ˆçœ‹ä¸‹é¢çš„å›¾ç‰‡ğŸ‘‡ï¼Œè¿™æ˜¯æ‰§è¡Œclickå‡½æ•°æ”¹å˜ä¸€ä¸ªæ•°æ®ä¹‹åå‘ç”Ÿçš„å‡½æ•°è°ƒç”¨æ ˆï¼Œä»å›¾ä¸Šçš„è¯´æ˜å¯ä»¥æ¯”è¾ƒæ¸…æ¥šä¸ªäº†è§£è¿™ä¸ªå“åº”å¼è¿‡ç¨‹çš„å¤§æ¦‚æµç¨‹ã€‚ä¸‹é¢ç®€å•è®²è§£ä¸€ä¸‹ï¼š</p>
<ol>
<li>æ”¹å˜æ•°æ®ï¼Œè§¦å‘è¿™ä¸ªè¢«åŠ«æŒè¿‡çš„æ•°æ®çš„<code>setter</code>æ–¹æ³•</li>
<li>æ‰§è¡Œè¿™ä¸ªæ•°æ®çš„è®¢é˜…ä¸­å¿ƒï¼ˆ<code>dep</code>ï¼‰çš„<code>notify</code>æ–¹æ³•</li>
<li><code>update</code>æ–¹æ³•é‡Œæ‰§è¡Œ<code>queueWatcher</code>æ–¹æ³•æŠŠ<code>watcher</code>æ¨å…¥é˜Ÿåˆ—</li>
<li>æ‰§è¡Œ<code>nextTick</code>æ–¹æ³•å¼€å§‹æ›´æ–°è§†å›¾</li>
<li><code>run</code>æ–¹æ³•é‡Œè®¾ç½®<code>dep.target</code>ä¸ºå½“å‰è®¢é˜…å¯¹è±¡</li>
<li>è°ƒç”¨<code>get</code>æ–¹æ³•è°ƒç”¨å½“å‰<code>watcher</code>çš„<code>getter</code>æ‰§è¡Œæ›´æ–°æ–¹æ³•</li>
<li><code>updateComponent</code>æ–¹æ³•é‡Œè°ƒç”¨äº†<code>render</code>æ–¹æ³•å¼€å§‹æ‰§è¡Œæ¸²æŸ“é¡µé¢</li>
<li><code>patch</code>ã€<code>patchVnode</code>ã€<code>updateChildren</code>æ–¹æ³•éƒ½æ˜¯æ¯”è¾ƒVNodeæ›´æ–°æ¸²æŸ“çš„å‡½æ•°ï¼Œä¸è¿‡é‡ç‚¹çš„diffè¿‡ç¨‹åœ¨<code>updateChildren</code>æ–¹æ³•é‡Œã€‚<br><img src="https://user-gold-cdn.xitu.io/2019/6/23/16b83a2e38faea15?w=1016&h=1066&f=png&s=181273"></li>
</ol>
<h2 id="2-vue-diffçš„å…·ä½“å®ç°"><a href="#2-vue-diffçš„å…·ä½“å®ç°" class="headerlink" title="2. vue-diffçš„å…·ä½“å®ç°"></a>2. vue-diffçš„å…·ä½“å®ç°</h2><p><code>patchVnode</code>ã€<code>updateChildren</code>æ–¹æ³•åœ¨vueæºç é¡¹ç›®çš„<code>src/core/vdom/patch.js</code>æ–‡ä»¶ä¸­ã€‚</p>
<p>å…ˆä»‹ç»<code>patchVnode</code>æ–¹æ³•ï¼Œè¿™æ˜¯æ‰§è¡ŒçœŸæ­£æ›´æ–°domçš„æ–¹æ³•ï¼Œå¤§æ¦‚çš„æ‰§è¡Œé€»è¾‘å¦‚ä¸‹</p>
<ol>
<li>åˆ¤æ–­vnodeå’ŒoldVnodeæ˜¯å¦ç›¸ç­‰</li>
<li>åˆ¤æ–­æ˜¯å¦èƒ½é‡ç”¨vnode</li>
<li>åˆ¤æ–­æ˜¯å¦æ‰§è¡Œå›è°ƒ</li>
<li>åˆ¤æ–­æ˜¯å¦æœ‰childrenéœ€è¦diffæ›´æ–°</li>
<li>åˆ¤æ–­æ‰§è¡Œæ›´æ–°ç±»å‹â€”æ–°å¢domã€ç§»é™¤domã€æ›´æ–°textDom</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">function patchVnode (</span><br><span class="line">  oldVnode,</span><br><span class="line">  vnode,</span><br><span class="line">  insertedVnodeQueue,</span><br><span class="line">  ownerArray,</span><br><span class="line">  index,</span><br><span class="line">  removeOnly</span><br><span class="line">) &#123;</span><br><span class="line">  if (oldVnode &#x3D;&#x3D;&#x3D; vnode) &#123;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (isDef(vnode.elm) &amp;&amp; isDef(ownerArray)) &#123;</span><br><span class="line">    &#x2F;&#x2F; clone reused vnode</span><br><span class="line">    vnode &#x3D; ownerArray[index] &#x3D; cloneVNode(vnode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const elm &#x3D; vnode.elm &#x3D; oldVnode.elm</span><br><span class="line"></span><br><span class="line">  if (isTrue(oldVnode.isAsyncPlaceholder)) &#123;</span><br><span class="line">    if (isDef(vnode.asyncFactory.resolved)) &#123;</span><br><span class="line">      hydrate(oldVnode.elm, vnode, insertedVnodeQueue)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      vnode.isAsyncPlaceholder &#x3D; true</span><br><span class="line">    &#125;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; reuse element for static trees.</span><br><span class="line">  &#x2F;&#x2F; note we only do this if the vnode is cloned -</span><br><span class="line">  &#x2F;&#x2F; if the new node is not cloned it means the render functions have been</span><br><span class="line">  &#x2F;&#x2F; reset by the hot-reload-api and we need to do a proper re-render.</span><br><span class="line">  if (isTrue(vnode.isStatic) &amp;&amp;</span><br><span class="line">    isTrue(oldVnode.isStatic) &amp;&amp;</span><br><span class="line">    vnode.key &#x3D;&#x3D;&#x3D; oldVnode.key &amp;&amp;</span><br><span class="line">    (isTrue(vnode.isCloned) || isTrue(vnode.isOnce))</span><br><span class="line">  ) &#123;</span><br><span class="line">    vnode.componentInstance &#x3D; oldVnode.componentInstance</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  let i</span><br><span class="line">  const data &#x3D; vnode.data</span><br><span class="line">  if (isDef(data) &amp;&amp; isDef(i &#x3D; data.hook) &amp;&amp; isDef(i &#x3D; i.prepatch)) &#123;</span><br><span class="line">    i(oldVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const oldCh &#x3D; oldVnode.children</span><br><span class="line">  const ch &#x3D; vnode.children</span><br><span class="line">  if (isDef(data) &amp;&amp; isPatchable(vnode)) &#123;</span><br><span class="line">    for (i &#x3D; 0; i &lt; cbs.update.length; ++i) cbs.update[i](oldVnode, vnode)</span><br><span class="line">    if (isDef(i &#x3D; data.hook) &amp;&amp; isDef(i &#x3D; i.update)) i(oldVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line">  if (isUndef(vnode.text)) &#123;</span><br><span class="line">    if (isDef(oldCh) &amp;&amp; isDef(ch)) &#123;</span><br><span class="line">      if (oldCh !&#x3D;&#x3D; ch) updateChildren(elm, oldCh, ch, insertedVnodeQueue, removeOnly)</span><br><span class="line">    &#125; else if (isDef(ch)) &#123;</span><br><span class="line">      if (process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39;) &#123;</span><br><span class="line">        checkDuplicateKeys(ch)</span><br><span class="line">      &#125;</span><br><span class="line">      if (isDef(oldVnode.text)) nodeOps.setTextContent(elm, &#39;&#39;)</span><br><span class="line">      addVnodes(elm, null, ch, 0, ch.length - 1, insertedVnodeQueue)</span><br><span class="line">    &#125; else if (isDef(oldCh)) &#123;</span><br><span class="line">      removeVnodes(oldCh, 0, oldCh.length - 1)</span><br><span class="line">    &#125; else if (isDef(oldVnode.text)) &#123;</span><br><span class="line">      nodeOps.setTextContent(elm, &#39;&#39;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else if (oldVnode.text !&#x3D;&#x3D; vnode.text) &#123;</span><br><span class="line">    nodeOps.setTextContent(elm, vnode.text)</span><br><span class="line">  &#125;</span><br><span class="line">  if (isDef(data)) &#123;</span><br><span class="line">    if (isDef(i &#x3D; data.hook) &amp;&amp; isDef(i &#x3D; i.postpatch)) i(oldVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬ç»å¸¸è¯´çš„vue-diffæ‰€åœ¨çš„æ–¹æ³•<code>updateChildren</code>ï¼Œå…ˆä»å‚æ•°è¯´èµ·ï¼Œåˆ†åˆ«æ˜¯çˆ¶å…ƒç´ domï¼Œæ—§çš„vnode-listï¼Œæ–°çš„vnode-listï¼Œéœ€è¦æ’å…¥çš„vnodeé˜Ÿåˆ—ï¼Œæ˜¯å¦ä»…ç§»é™¤ã€‚</p>
<p>é‡ç‚¹çš„é€»è¾‘åœ¨<code>while</code>å¾ªç¯é‡Œï¼š</p>
<p>å¦‚ä½•ç†è§£è¿™ä¸ªdiffé€»è¾‘ï¼Œå…¶å®æ˜¯åˆ†åˆ«æœ‰æ–°æ—§ä¸¤ä¸ªvnode-listï¼Œä¸¤ä¸ªlistéƒ½è®¾å®šç¬¬ä¸€ä½å’Œæœ€åä¸€ä½ä½œä¸ºä¸¤ä¸ªæ¸¸æ ‡ï¼Œé€šè¿‡ä¸€ç³»åˆ—åˆ¤æ–­å¯¹æ¯”ï¼Œä¸æ–­é€¼è¿‘ï¼Œå½“ä¸¤ä¸ªlistçš„ä¸¤ä¸ªæ¸¸æ ‡ç›¸äº¤åˆ™å¾ªç¯ç»“æŸã€‚</p>
<p>è‡³äºå…·ä½“åˆ¤æ–­çš„é€»è¾‘å°±ä¸èµ˜è¿°äº†ï¼Œä»£ç å·²ç»å†™å¾—éå¸¸æ¸…æ¥šäº†ï¼Œåœ¨è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„<code>sameVnode</code>çš„åˆ¤æ–­ï¼Œåœ¨ä½¿ç”¨<code>v-for</code>ç”Ÿæˆçš„vnode-listä¸è®¾ç½®<code>key</code>çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å¯¹æ¯”æ›´æ–°å‡ ä¹éƒ½ä¼šä»ç¬¬ä¸‰å’Œç¬¬å››ä¸ªåˆ¤æ–­åˆ†æ”¯è¿›è¡Œï¼Œå³ä»£ç ä¸­çš„<code>sameVnode(oldStartVnode, newStartVnode)</code>å’Œ<code>sameVnode(oldEndVnode, newEndVnode)</code>åˆ¤æ–­ï¼Œä¸‹é¢çœ‹çœ‹<code>sameVnode</code>çš„æ–¹æ³•ï¼Œå½“æˆ‘ä»¬ä¸è®¾ç½®keyçš„æ—¶å€™ï¼Œåˆ¤æ–­çš„é€»è¾‘ä¼šé€šè¿‡tagç±»å‹å’Œvnodeçš„æ•°æ®æŸäº›å±æ€§è¿›è¡Œæ¯”è¾ƒï¼Œé€šå¸¸æ¥è¯´éƒ½æ˜¯ç›¸åŒçš„ï¼Œè¿™å°±æ˜¯å®˜æ–¹æ–‡æ¡£è¯´çš„<font color=red>åŸåœ°å¤ç”¨</font>é€»è¾‘ï¼Œç›´æ¥æ›´æ–°å½“å‰èŠ‚ç‚¹çš„å†…å®¹ï¼Œä¸éœ€è¦å¯¹å½“å‰çš„èŠ‚ç‚¹è¿›è¡Œç§»åŠ¨ã€‚è¿™å¯¹äºèŠ‚ç‚¹å†…å®¹ç›¸å¯¹ç®€å•çš„æ¥è¯´é»˜è®¤ä¼šæ›´é«˜æ•ˆï¼Œä½†æ˜¯å½“èŠ‚ç‚¹å†…å®¹ç›¸å¯¹å¤æ‚çš„æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¯¹èŠ‚ç‚¹å†…å®¹è¿›è¡Œå¤ç”¨è€Œä¸æ˜¯é‡æ–°ç”Ÿæˆï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦è®¾ç½®<code>key</code>æ¥å¤ç”¨èŠ‚ç‚¹ã€‚</p>
<p>æœ€åçš„ä¸€æ®µåˆ¤æ–­<code>oldStartIdx > oldEndIdx</code>å’Œ<code>newStartIdx > newEndIdx</code>åˆ™è¯´æ˜ç¬¦åˆè¿™ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™æˆ‘ä»¬å½“å‰vnode-listæ˜¯ä»æ— åˆ°æœ‰æˆ–ä»æœ‰åˆ°æ— çš„å˜åŒ–ã€‚</p>
<p>å›¾ç¤ºï¼šå®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ï¼ˆğŸ‘‡ï¼‰</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/23/16b84467afb18dfd?w=1458&h=632&f=png&s=186334"></p>
<p><code>sameVnode</code>æ–¹æ³•å®šä¹‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function sameVnode (a, b) &#123;</span><br><span class="line">  return (</span><br><span class="line">    a.key &#x3D;&#x3D;&#x3D; b.key &amp;&amp; (</span><br><span class="line">      (</span><br><span class="line">        a.tag &#x3D;&#x3D;&#x3D; b.tag &amp;&amp;</span><br><span class="line">        a.isComment &#x3D;&#x3D;&#x3D; b.isComment &amp;&amp;</span><br><span class="line">        isDef(a.data) &#x3D;&#x3D;&#x3D; isDef(b.data) &amp;&amp;</span><br><span class="line">        sameInputType(a, b)</span><br><span class="line">      ) || (</span><br><span class="line">        isTrue(a.isAsyncPlaceholder) &amp;&amp;</span><br><span class="line">        a.asyncFactory &#x3D;&#x3D;&#x3D; b.asyncFactory &amp;&amp;</span><br><span class="line">        isUndef(b.asyncFactory.error)</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>updateChildren</code>æ–¹æ³•å®šä¹‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">function updateChildren (parentElm, oldCh, newCh, insertedVnodeQueue, removeOnly) &#123;</span><br><span class="line">  let oldStartIdx &#x3D; 0</span><br><span class="line">  let newStartIdx &#x3D; 0</span><br><span class="line">  let oldEndIdx &#x3D; oldCh.length - 1</span><br><span class="line">  let oldStartVnode &#x3D; oldCh[0]</span><br><span class="line">  let oldEndVnode &#x3D; oldCh[oldEndIdx]</span><br><span class="line">  let newEndIdx &#x3D; newCh.length - 1</span><br><span class="line">  let newStartVnode &#x3D; newCh[0]</span><br><span class="line">  let newEndVnode &#x3D; newCh[newEndIdx]</span><br><span class="line">  let oldKeyToIdx, idxInOld, vnodeToMove, refElm</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; removeOnly is a special flag used only by &lt;transition-group&gt;</span><br><span class="line">  &#x2F;&#x2F; to ensure removed elements stay in correct relative positions</span><br><span class="line">  &#x2F;&#x2F; during leaving transitions</span><br><span class="line">  const canMove &#x3D; !removeOnly</span><br><span class="line"></span><br><span class="line">  if (process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39;) &#123;</span><br><span class="line">    checkDuplicateKeys(newCh)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  while (oldStartIdx &lt;&#x3D; oldEndIdx &amp;&amp; newStartIdx &lt;&#x3D; newEndIdx) &#123;</span><br><span class="line">    if (isUndef(oldStartVnode)) &#123;</span><br><span class="line">      oldStartVnode &#x3D; oldCh[++oldStartIdx] &#x2F;&#x2F; Vnode has been moved left</span><br><span class="line">    &#125; else if (isUndef(oldEndVnode)) &#123;</span><br><span class="line">      oldEndVnode &#x3D; oldCh[--oldEndIdx]</span><br><span class="line">    &#125; else if (sameVnode(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">      patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">      oldStartVnode &#x3D; oldCh[++oldStartIdx]</span><br><span class="line">      newStartVnode &#x3D; newCh[++newStartIdx]</span><br><span class="line">    &#125; else if (sameVnode(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">      patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span><br><span class="line">      oldEndVnode &#x3D; oldCh[--oldEndIdx]</span><br><span class="line">      newEndVnode &#x3D; newCh[--newEndIdx]</span><br><span class="line">    &#125; else if (sameVnode(oldStartVnode, newEndVnode)) &#123; &#x2F;&#x2F; Vnode moved right</span><br><span class="line">      patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span><br><span class="line">      canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm))</span><br><span class="line">      oldStartVnode &#x3D; oldCh[++oldStartIdx]</span><br><span class="line">      newEndVnode &#x3D; newCh[--newEndIdx]</span><br><span class="line">    &#125; else if (sameVnode(oldEndVnode, newStartVnode)) &#123; &#x2F;&#x2F; Vnode moved left</span><br><span class="line">      patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">      canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm)</span><br><span class="line">      oldEndVnode &#x3D; oldCh[--oldEndIdx]</span><br><span class="line">      newStartVnode &#x3D; newCh[++newStartIdx]</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      if (isUndef(oldKeyToIdx)) oldKeyToIdx &#x3D; createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">      idxInOld &#x3D; isDef(newStartVnode.key)</span><br><span class="line">        ? oldKeyToIdx[newStartVnode.key]</span><br><span class="line">        : findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">      if (isUndef(idxInOld)) &#123; &#x2F;&#x2F; New element</span><br><span class="line">        createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        vnodeToMove &#x3D; oldCh[idxInOld]</span><br><span class="line">        if (sameVnode(vnodeToMove, newStartVnode)) &#123;</span><br><span class="line">          patchVnode(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">          oldCh[idxInOld] &#x3D; undefined</span><br><span class="line">          canMove &amp;&amp; nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          &#x2F;&#x2F; same key but different element. treat as new element</span><br><span class="line">          createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      newStartVnode &#x3D; newCh[++newStartIdx]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  if (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">    refElm &#x3D; isUndef(newCh[newEndIdx + 1]) ? null : newCh[newEndIdx + 1].elm</span><br><span class="line">    addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue)</span><br><span class="line">  &#125; else if (newStartIdx &gt; newEndIdx) &#123;</span><br><span class="line">    removeVnodes(oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å…¶å®vue-diffçš„ç®—æ³•å¹¶ä¸å¤æ‚ï¼Œä»£ç é˜…è¯»èµ·æ¥ä¹Ÿç›¸å¯¹å®¹æ˜“ã€‚åœ¨vueé‡Œä»patchåˆ°è§†å›¾çš„å˜åŒ–æ˜¯å®æ—¶çš„ï¼Œå³å‡å¦‚å­˜åœ¨3ä¸ªèŠ‚ç‚¹å˜åŒ–ï¼Œvueå¹¶ä¸æ˜¯æ”¶é›†å®Œæ‰€æœ‰çš„patchå†ä¸€æ¬¡æ€§æ›´æ–°è§†å›¾ï¼Œè€Œæ˜¯åœ¨éå†diffçš„è¿‡ç¨‹ä¸­patchç›´æ¥æ›´æ–°è§†å›¾ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/23/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94vue-diff/" data-id="ckedpbrur00131zm1cfntgzu1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-å­¦ä¹ vue-routeræºç è®°å½•-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/16/%E5%AD%A6%E4%B9%A0vue-router%E6%BA%90%E7%A0%81%E8%AE%B0%E5%BD%95-2/" class="article-date">
  <time datetime="2019-06-16T14:42:32.000Z" itemprop="datePublished">2019-06-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>â–º<a class="article-category-link" href="/categories/JavaScript/Vue/">Vue</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/16/%E5%AD%A6%E4%B9%A0vue-router%E6%BA%90%E7%A0%81%E8%AE%B0%E5%BD%95-2/">å­¦ä¹ vue-routeræºç è®°å½•-2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>ç»§ä¸Šä¸€éæ–‡ç« å¤§æ¦‚ä»‹ç»äº†vue-routeré‡Œé¢çš„æ¦‚å¿µï¼Œè¿™ä¸€ç¯‡æ–‡ç« ä¸»è¦è¯¦ç»†ä»‹ç»è·¯ç”±è·³è½¬ä¸­å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>
</blockquote>
<p> è·¯ç”±è·³è½¬æ‰§è¡Œçš„ä»£ç ä¸»è¦åœ¨<code>./base.js</code>æ–‡ä»¶é‡Œï¼Œè¯¦ç»†çœ‹<code>transitionTo</code>æ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">transitionTo (location: RawLocation, onComplete?: Function, onAbort?: Function) &#123;</span><br><span class="line">    const route &#x3D; this.router.match(location, this.current)</span><br><span class="line">    this.confirmTransition(route, () &#x3D;&gt; &#123;</span><br><span class="line">      this.updateRoute(route)</span><br><span class="line">      onComplete &amp;&amp; onComplete(route)</span><br><span class="line">      this.ensureURL()</span><br><span class="line"></span><br><span class="line">      &#x2F;&#x2F; fire ready cbs once</span><br><span class="line">      if (!this.ready) &#123;</span><br><span class="line">        this.ready &#x3D; true</span><br><span class="line">        this.readyCbs.forEach(cb &#x3D;&gt; &#123; cb(route) &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, err &#x3D;&gt; &#123;</span><br><span class="line">      if (onAbort) &#123;</span><br><span class="line">        onAbort(err)</span><br><span class="line">      &#125;</span><br><span class="line">      if (err &amp;&amp; !this.ready) &#123;</span><br><span class="line">        this.ready &#x3D; true</span><br><span class="line">        this.readyErrorCbs.forEach(cb &#x3D;&gt; &#123; cb(err) &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><code>transitionTo</code>ä»£ç éå¸¸ç®€å•ï¼Œæ‰§è¡Œ<code>this.route.match</code>ï¼Œé€šè¿‡æ¯”è¾ƒæ–°çš„è·¯ç”±å’Œå°±å¾—è·¯ç”±æ‹¿åˆ°ä¸€ä¸ª<code>route</code>å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œ<code>confirmTransition</code>ç¡®è®¤è·¯ç”±è·³è½¬ã€‚</p>
<p>ä¸‹é¢çœ‹çœ‹è¿™ä¸ª<code>route</code>å¯¹è±¡çš„å®šä¹‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">declare type Route &#x3D; &#123;</span><br><span class="line">  path: string;</span><br><span class="line">  name: ?string;</span><br><span class="line">  hash: string;</span><br><span class="line">  query: Dictionary&lt;string&gt;;</span><br><span class="line">  params: Dictionary&lt;string&gt;;</span><br><span class="line">  fullPath: string;</span><br><span class="line">  matched: Array&lt;RouteRecord&gt;;</span><br><span class="line">  redirectedFrom?: string;</span><br><span class="line">  meta?: any;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹ç…§ä»£ç ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹<code>matched</code>è¿™ä¸ªå±æ€§ï¼Œåœ¨ä¸Šä¸€ç¯‡æ–‡ç« é‡Œé¢å·²ç»ä»‹ç»è¿‡<code>RouteRecord</code>å¯¹è±¡çš„å®šä¹‰ã€‚è·¯ç”±ä¸€å¼€å§‹ä¼šæ‰§è¡Œ<code>createMatcher</code>ç”Ÿæˆä¸€ä¸ªè·¯ç”±æ˜ å°„è¡¨ï¼Œå› æ­¤<code>matched</code>é‡Œé¢å­˜æ”¾å°±æ˜¯æˆ‘ä»¬<font color=red>å°†è¦è·³è½¬åˆ°çš„è·¯ç”±åŒ¹é…ä¸Šçš„è·¯ç”±é…ç½®å¯¹è±¡</font>ã€‚</p>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">    path: &#39;&#x2F;parent&#39;,</span><br><span class="line">    component: Parent,</span><br><span class="line">    children: [</span><br><span class="line">    &#123; path: &#39;foo&#39;, component: Foo &#125;,</span><br><span class="line">    &#123; path: &#39;bar&#39;, component: Bar &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<p>å‡è®¾æˆ‘ä»¬é…ç½®äº†ä»¥ä¸‹çš„è·¯ç”±ï¼Œ<code>createMatcher</code>ä¼šç”Ÿæˆæ ¹æ®pathå»ºç«‹çš„æ˜ å°„è¡¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pathMap &#x3D; &#123;</span><br><span class="line">    &#39;&#x2F;parent&#39;: RouteRecord,</span><br><span class="line">    &#39;&#x2F;parent&#x2F;foo&#39;: RouteRecord,</span><br><span class="line">    &#39;&#x2F;parent&#x2F;bar&#39;: RouteRecord,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡å¦‚æˆ‘ä»¬å‘ç”Ÿäº†ä¸€ä¸ªä»<code>/parent</code>è·¯ç”±è·³è½¬åˆ°<code>/parent/foo</code>è·¯ç”±ï¼Œé¦–å…ˆæ‰§è¡Œä»¥ä¸‹ä»£ç ç”Ÿæˆçš„<code>route</code>å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const route &#x3D; this.router.match(location, this.current)</span><br></pre></td></tr></table></figure>

<p>å› æ­¤æ ¹æ®æˆ‘ä»¬å‡è®¾çš„é…ç½®ï¼Œè¿™é‡Œçš„<code>route</code>é‡Œçš„<code>matched</code>å°†ä¼šåŒ…å«<code>/parent</code>å’Œ<code>/parent/foo</code>çš„<code>RouteRecord</code>ã€‚è‡³äºå…·ä½“çš„<code>match</code>æ–¹æ³•ä»£ç å°±ä¸è¯¦ç»†è§£é‡Šäº†ã€‚</p>
<p>ç»§ç»­è®²è·¯ç”±çš„è·³è½¬ï¼Œç”Ÿæˆ<code>route</code>å¯¹è±¡åå°†ä¼šæ‰§è¡Œä¸€ä¸ªç¡®è®¤çš„æ–¹æ³•<code>confirmTransition</code>ã€‚</p>
<p>ç”±äºè¿™ä¸ªæ–¹æ³•ä»£ç æ¯”è¾ƒé•¿ï¼Œæˆ‘ä»¬æ‹†å¼€æ¥è¯´æ˜ï¼Œé¦–å…ˆçœ‹è¿™ä¸ªæ–¹æ³•çš„å…¥å‚è¯´æ˜ï¼Œæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œ<code>route</code>å¯¹è±¡åœ¨å‰é¢å·²ç»ç”Ÿæˆè¿‡äº†ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯æ‰§è¡Œå®Œæˆçš„å›è°ƒæ–¹æ³•å’Œé€€å‡ºçš„å›è°ƒæ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">confirmTransition (route: Route, onComplete: Function, onAbort?: Function)</span><br></pre></td></tr></table></figure>

<p>åœ¨ä»£ç çš„ä¸€å¼€å§‹é¦–å…ˆåˆ¤æ–­å½“å‰è·¯ç”±ä¸è·³è½¬çš„è·¯ç”±æ˜¯å¦æ˜¯åŒä¸€ä¸ªè·¯ç”±ï¼Œå¦‚æœæ˜¯åˆ™ç›´æ¥é€€å‡ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const current &#x3D; this.current</span><br><span class="line">const abort &#x3D; err &#x3D;&gt; &#123;</span><br><span class="line">  if (isError(err)) &#123;</span><br><span class="line">    if (this.errorCbs.length) &#123;</span><br><span class="line">      this.errorCbs.forEach(cb &#x3D;&gt; &#123; cb(err) &#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      warn(false, &#39;uncaught error during route navigation:&#39;)</span><br><span class="line">      console.error(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  onAbort &amp;&amp; onAbort(err)</span><br><span class="line">&#125;</span><br><span class="line">if (</span><br><span class="line">  isSameRoute(route, current) &amp;&amp;</span><br><span class="line">  &#x2F;&#x2F; in the case the route map has been dynamically appended to</span><br><span class="line">  route.matched.length &#x3D;&#x3D;&#x3D; current.matched.length</span><br><span class="line">) &#123;</span><br><span class="line">  this.ensureURL()</span><br><span class="line">  return abort()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„<code>ensureURL</code>æ–¹æ³•å®šä¹‰åœ¨<code>HTML5History</code>çš„åŸå‹é“¾ä¸Šï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ä¿å­˜è·¯ç”±å˜åŒ–å†å²è®°å½•ï¼Œæ ¹æ®<code>push</code>æ˜¯<code>true</code>æˆ–<code>false</code>æ¥ç¡®å®šæ‰§è¡Œ<code>pushState</code>è¿˜æ˜¯<code>replaceState</code>ã€‚è¿™ä¸€æ–¹æ³•åœ¨æ‰§è¡Œå®Œè·¯ç”±è·³è½¬ååŒæ ·ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTML5History.prototype.ensureURL &#x3D; function ensureURL (push) &#123;</span><br><span class="line">  if (getLocation(this.base) !&#x3D;&#x3D; this.current.fullPath) &#123;</span><br><span class="line">    var current &#x3D; cleanPath(this.base + this.current.fullPath);</span><br><span class="line">    push ? pushState(current) : replaceState(current);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­çœ‹åé¢çš„ä»£ç ï¼Œé¦–å…ˆé€šè¿‡<code>resolveQueue</code>å¯¹æ¯”<code>this.current</code>å’Œ<code>route</code>å¯¹è±¡çš„<code>matched</code>æå–ä¸‰ç§å˜åŒ–çš„ç»„ä»¶é˜Ÿåˆ—ã€‚æ ¹æ®å‘½åæˆ‘ä»¬ç›´æ¥å¯å¾—çŸ¥<code>updated</code>ã€<code>deactivated</code>ã€<code>activated</code>åˆ†åˆ«å¯¹åº”æ›´æ–°çš„ç»„ä»¶ã€å¤±æ•ˆçš„ç»„ä»¶ã€æ¿€æ´»çš„ç»„ä»¶ã€‚ç„¶åç”Ÿæˆä¸€ä¸ªéœ€è¦æ‰§è¡Œæ–¹æ³•çš„é˜Ÿåˆ—<code>queue</code>ï¼Œæ ¹æ®è¿™ä¸ªé˜Ÿåˆ—çš„ç”Ÿæˆå®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ‰§è¡Œæ–¹æ³•çš„é¡ºåºï¼Œè‡³äºé€šè¿‡<code>extractLeaveGuards</code>å’Œ<code>extractUpdateHooks</code>æ–¹æ³•æå–ç»„ä»¶é‡Œçš„å®ˆå«å‡½æ•°å°±ä¸ç»†è¯´äº†ã€‚</p>
<ol>
<li><p>åœ¨å¤±æ´»çš„ç»„ä»¶é‡Œè°ƒç”¨ç¦»å¼€å®ˆå«ã€‚</p>
</li>
<li><p>è°ƒç”¨å…¨å±€çš„ beforeEach å®ˆå«ã€‚</p>
</li>
<li><p>åœ¨é‡ç”¨çš„ç»„ä»¶é‡Œè°ƒç”¨ beforeRouteUpdate å®ˆå«</p>
</li>
<li><p>åœ¨æ¿€æ´»çš„è·¯ç”±é…ç½®é‡Œè°ƒç”¨ beforeEnterã€‚</p>
</li>
<li><p>è§£æå¼‚æ­¥è·¯ç”±ç»„ä»¶ã€‚</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const &#123;</span><br><span class="line">  updated,</span><br><span class="line">  deactivated,</span><br><span class="line">  activated</span><br><span class="line">&#125; &#x3D; resolveQueue(this.current.matched, route.matched)</span><br><span class="line"></span><br><span class="line">const queue: Array&lt;?NavigationGuard&gt; &#x3D; [].concat(</span><br><span class="line">  &#x2F;&#x2F; in-component leave guards</span><br><span class="line">  extractLeaveGuards(deactivated),</span><br><span class="line">  &#x2F;&#x2F; global before hooks</span><br><span class="line">  this.router.beforeHooks,</span><br><span class="line">  &#x2F;&#x2F; in-component update hooks</span><br><span class="line">  extractUpdateHooks(updated),</span><br><span class="line">  &#x2F;&#x2F; in-config enter guards</span><br><span class="line">  activated.map(m &#x3D;&gt; m.beforeEnter),</span><br><span class="line">  &#x2F;&#x2F; async components</span><br><span class="line">  resolveAsyncComponents(activated)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹<code>resolveQueue</code>æ˜¯å¦‚ä½•æå–å˜åŒ–çš„ç»„ä»¶ã€‚æ¯”è¾ƒ<code>current</code>å’Œ<code>next</code>ç¡®å®šä¸€ä¸ªå˜åŒ–çš„ä½ç½®<code>i</code>ï¼Œ<code>next</code>é‡Œçš„ä»<code>0</code>åˆ°<code>i</code>åˆ™æ˜¯<code>updated</code>çš„éƒ¨åˆ†ï¼Œ<code>i</code>ä¹‹åçš„åˆ™æ˜¯<code>activated</code>çš„éƒ¨åˆ†ï¼Œè€Œ<code>current</code>é‡Œ<code>i</code>ä¹‹åçš„åˆ™æ˜¯<code>deactivated</code>çš„éƒ¨åˆ†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function resolveQueue (</span><br><span class="line">  current: Array&lt;RouteRecord&gt;,</span><br><span class="line">  next: Array&lt;RouteRecord&gt;</span><br><span class="line">): &#123;</span><br><span class="line">  updated: Array&lt;RouteRecord&gt;,</span><br><span class="line">  activated: Array&lt;RouteRecord&gt;,</span><br><span class="line">  deactivated: Array&lt;RouteRecord&gt;</span><br><span class="line">&#125; &#123;</span><br><span class="line">  let i</span><br><span class="line">  const max &#x3D; Math.max(current.length, next.length)</span><br><span class="line">  for (i &#x3D; 0; i &lt; max; i++) &#123;</span><br><span class="line">    if (current[i] !&#x3D;&#x3D; next[i]) &#123;</span><br><span class="line">      break</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return &#123;</span><br><span class="line">    updated: next.slice(0, i),</span><br><span class="line">    activated: next.slice(i),</span><br><span class="line">    deactivated: current.slice(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±æ˜¯ç”Ÿæˆè¿­ä»£å™¨æ–¹æ³•<code>iterator</code>ï¼Œæ‰§è¡Œ<code>runQueue</code>æ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">this.pending &#x3D; route</span><br><span class="line">const iterator &#x3D; (hook: NavigationGuard, next) &#x3D;&gt; &#123;</span><br><span class="line">  if (this.pending !&#x3D;&#x3D; route) &#123;</span><br><span class="line">    return abort()</span><br><span class="line">  &#125;</span><br><span class="line">  try &#123;</span><br><span class="line">    hook(route, current, (to: any) &#x3D;&gt; &#123;</span><br><span class="line">      if (to &#x3D;&#x3D;&#x3D; false || isError(to)) &#123;</span><br><span class="line">        &#x2F;&#x2F; next(false) -&gt; abort navigation, ensure current URL</span><br><span class="line">        this.ensureURL(true)</span><br><span class="line">        abort(to)</span><br><span class="line">      &#125; else if (</span><br><span class="line">        typeof to &#x3D;&#x3D;&#x3D; &#39;string&#39; ||</span><br><span class="line">        (typeof to &#x3D;&#x3D;&#x3D; &#39;object&#39; &amp;&amp; (</span><br><span class="line">          typeof to.path &#x3D;&#x3D;&#x3D; &#39;string&#39; ||</span><br><span class="line">          typeof to.name &#x3D;&#x3D;&#x3D; &#39;string&#39;</span><br><span class="line">        ))</span><br><span class="line">      ) &#123;</span><br><span class="line">        &#x2F;&#x2F; next(&#39;&#x2F;&#39;) or next(&#123; path: &#39;&#x2F;&#39; &#125;) -&gt; redirect</span><br><span class="line">        abort()</span><br><span class="line">        if (typeof to &#x3D;&#x3D;&#x3D; &#39;object&#39; &amp;&amp; to.replace) &#123;</span><br><span class="line">          this.replace(to)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.push(to)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        &#x2F;&#x2F; confirm transition and pass on the value</span><br><span class="line">        next(to)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    abort(e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">runQueue(queue, iterator, () &#x3D;&gt; &#123;</span><br><span class="line">  const postEnterCbs &#x3D; []</span><br><span class="line">  const isValid &#x3D; () &#x3D;&gt; this.current &#x3D;&#x3D;&#x3D; route</span><br><span class="line">  &#x2F;&#x2F; wait until async components are resolved before</span><br><span class="line">  &#x2F;&#x2F; extracting in-component enter guards</span><br><span class="line">  const enterGuards &#x3D; extractEnterGuards(activated, postEnterCbs, isValid)</span><br><span class="line">  const queue &#x3D; enterGuards.concat(this.router.resolveHooks)</span><br><span class="line">  runQueue(queue, iterator, () &#x3D;&gt; &#123;</span><br><span class="line">    if (this.pending !&#x3D;&#x3D; route) &#123;</span><br><span class="line">      return abort()</span><br><span class="line">    &#125;</span><br><span class="line">    this.pending &#x3D; null</span><br><span class="line">    onComplete(route)</span><br><span class="line">    if (this.router.app) &#123;</span><br><span class="line">      this.router.app.$nextTick(() &#x3D;&gt; &#123;</span><br><span class="line">        postEnterCbs.forEach(cb &#x3D;&gt; &#123; cb() &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>runQueue</code>æ–¹æ³•çš„ä»£ç å¹¶ä¸å¤æ‚ï¼Œä¸€ä¸ªé€’å½’æ‰§è¡Œé˜Ÿåˆ—çš„æ–¹æ³•ï¼Œä½¿ç”¨<code>iterator(fnå‚æ•°)</code>æ‰§è¡Œ<code>queue</code>ï¼Œ<code>iterator</code>é‡Œç»™<code>hook</code>ä¼ å…¥çš„å‚æ•°åˆ†åˆ«ä»£è¡¨<code>to</code>ã€<code>from</code>ã€<code>next</code>ï¼Œåœ¨é˜Ÿåˆ—æ‰§è¡Œå®Œåæ‰§è¡Œä¼ å…¥çš„å›è°ƒæ–¹æ³•ã€‚è¿™é‡Œæ‰§è¡Œè¿‡ç¨‹ä»£è¡¨äº†vue-routerçš„å®ˆå«å‡½æ•°çš„æ‰§è¡Œå‡½æ•°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">export function runQueue (queue: Array&lt;?NavigationGuard&gt;, fn: Function, cb: Function) &#123;</span><br><span class="line">  const step &#x3D; index &#x3D;&gt; &#123;</span><br><span class="line">    if (index &gt;&#x3D; queue.length) &#123;</span><br><span class="line">      cb()</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      if (queue[index]) &#123;</span><br><span class="line">        fn(queue[index], () &#x3D;&gt; &#123;</span><br><span class="line">          step(index + 1)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        step(index + 1)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  step(0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»¼ä¸Šæ‰€è¿°ï¼Œè·¯ç”±è·³è½¬çš„å˜åŒ–å¤§æ¦‚ä¸Šå·²ç»è§£é‡Šå®Œï¼Œå½“ç„¶è¿™å¹¶ä¸æ˜¯å®Œæ•´çš„æ‰§è¡Œé€»è¾‘ï¼Œåªæ˜¯è·¯ç”±è·³è½¬å¤§æ¦‚çš„è¿‡ç¨‹å·®ä¸å¤šå°±æ˜¯å¦‚æ­¤ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/16/%E5%AD%A6%E4%B9%A0vue-router%E6%BA%90%E7%A0%81%E8%AE%B0%E5%BD%95-2/" data-id="ckedpbrui000k1zm16u7na71n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-å­¦ä¹ vue-routeræºç è®°å½•" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/07/%E5%AD%A6%E4%B9%A0vue-router%E6%BA%90%E7%A0%81%E8%AE%B0%E5%BD%95/" class="article-date">
  <time datetime="2019-06-07T14:42:32.000Z" itemprop="datePublished">2019-06-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>â–º<a class="article-category-link" href="/categories/JavaScript/Vue/">Vue</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/07/%E5%AD%A6%E4%B9%A0vue-router%E6%BA%90%E7%A0%81%E8%AE%B0%E5%BD%95/">å­¦ä¹ vue-routeræºç è®°å½•-1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>å› ä¸ºæœ¬äººå¼€å‘ä¸­ä½¿ç”¨çš„æ˜¯VUEæŠ€æœ¯æ ˆï¼Œæœ€è¿‘ä¹Ÿæ˜¯å¼€å§‹æºç çš„å­¦ä¹ ï¼Œä»¥æ­¤è®°å½•ä¸ªäººç†è§£ï¼Œè‹¥è¡Œæ–‡æœ‰è¯¯ï¼Œè¯·å¤šå¤šæŒ‡æ•™ã€‚</p>
</blockquote>
<h2 id="1-new-Routerå’Œinstall"><a href="#1-new-Routerå’Œinstall" class="headerlink" title="1.new Routerå’Œinstall"></a>1.new Routerå’Œinstall</h2><p>åœ¨vueä¸­æˆ‘ä»¬ä½¿ç”¨vue-routeræ—¶éœ€è¦å…ˆè¿›è¡Œ<code>new Router()</code>ï¼Œæ‰§è¡Œ<code>new Router()</code>åä¸»è¦æ‰§è¡Œä»£ç çœ‹çœ‹VueRouter classå®šä¹‰çš„<code>constructor</code>æ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">constructor (options: RouterOptions &#x3D; &#123;&#125;) &#123;</span><br><span class="line">    this.app &#x3D; null</span><br><span class="line">    this.apps &#x3D; []</span><br><span class="line">    this.options &#x3D; options</span><br><span class="line">    this.beforeHooks &#x3D; []</span><br><span class="line">    this.resolveHooks &#x3D; []</span><br><span class="line">    this.afterHooks &#x3D; []</span><br><span class="line">    this.matcher &#x3D; createMatcher(options.routes || [], this)</span><br><span class="line"></span><br><span class="line">    let mode &#x3D; options.mode || &#39;hash&#39;</span><br><span class="line">    this.fallback &#x3D; mode &#x3D;&#x3D;&#x3D; &#39;history&#39; &amp;&amp; !supportsPushState &amp;&amp; options.fallback !&#x3D;&#x3D; false</span><br><span class="line">    if (this.fallback) &#123;</span><br><span class="line">      mode &#x3D; &#39;hash&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!inBrowser) &#123;</span><br><span class="line">      mode &#x3D; &#39;abstract&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    this.mode &#x3D; mode</span><br><span class="line"></span><br><span class="line">    switch (mode) &#123;</span><br><span class="line">      case &#39;history&#39;:</span><br><span class="line">        this.history &#x3D; new HTML5History(this, options.base)</span><br><span class="line">        break</span><br><span class="line">      case &#39;hash&#39;:</span><br><span class="line">        this.history &#x3D; new HashHistory(this, options.base, this.fallback)</span><br><span class="line">        break</span><br><span class="line">      case &#39;abstract&#39;:</span><br><span class="line">        this.history &#x3D; new AbstractHistory(this, options.base)</span><br><span class="line">        break</span><br><span class="line">      default:</span><br><span class="line">        if (process.env.NODE_ENV !&#x3D;&#x3D; &#39;production&#39;) &#123;</span><br><span class="line">          assert(false, &#96;invalid mode: $&#123;mode&#125;&#96;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä»£ç é‡Œé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨<code>new</code>çš„æ—¶å€™ç¡®å®šäº†ä½¿ç”¨ä½•ç§è·¯ç”±æ¨¡å¼ï¼Œå¹¶ä¸”æ ¹æ®ä¼ å…¥optionsåˆ›å»º<code>matcher</code>ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹çœ‹å½“ä½¿ç”¨<code>vue.use()</code>æ‰§è¡Œinstallæ–¹æ³•åšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">export function install (Vue) &#123;</span><br><span class="line">  if (install.installed &amp;&amp; _Vue &#x3D;&#x3D;&#x3D; Vue) return</span><br><span class="line">  install.installed &#x3D; true</span><br><span class="line"></span><br><span class="line">  _Vue &#x3D; Vue</span><br><span class="line"></span><br><span class="line">  const isDef &#x3D; v &#x3D;&gt; v !&#x3D;&#x3D; undefined</span><br><span class="line"></span><br><span class="line">  const registerInstance &#x3D; (vm, callVal) &#x3D;&gt; &#123;</span><br><span class="line">    let i &#x3D; vm.$options._parentVnode</span><br><span class="line">    if (isDef(i) &amp;&amp; isDef(i &#x3D; i.data) &amp;&amp; isDef(i &#x3D; i.registerRouteInstance)) &#123;</span><br><span class="line">      i(vm, callVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.mixin(&#123;</span><br><span class="line">    beforeCreate () &#123;</span><br><span class="line">      if (isDef(this.$options.router)) &#123;</span><br><span class="line">        this._routerRoot &#x3D; this</span><br><span class="line">        this._router &#x3D; this.$options.router</span><br><span class="line">        this._router.init(this)</span><br><span class="line">        Vue.util.defineReactive(this, &#39;_route&#39;, this._router.history.current)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this._routerRoot &#x3D; (this.$parent &amp;&amp; this.$parent._routerRoot) || this</span><br><span class="line">      &#125;</span><br><span class="line">      registerInstance(this, this)</span><br><span class="line">    &#125;,</span><br><span class="line">    destroyed () &#123;</span><br><span class="line">      registerInstance(this)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  Object.defineProperty(Vue.prototype, &#39;$router&#39;, &#123;</span><br><span class="line">    get () &#123; return this._routerRoot._router &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  Object.defineProperty(Vue.prototype, &#39;$route&#39;, &#123;</span><br><span class="line">    get () &#123; return this._routerRoot._route &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  Vue.component(&#39;RouterView&#39;, View)</span><br><span class="line">  Vue.component(&#39;RouterLink&#39;, Link)</span><br><span class="line"></span><br><span class="line">  const strats &#x3D; Vue.config.optionMergeStrategies</span><br><span class="line">  &#x2F;&#x2F; use the same hook merging strategy for route hooks</span><br><span class="line">  strats.beforeRouteEnter &#x3D; strats.beforeRouteLeave &#x3D; strats.beforeRouteUpdate &#x3D; strats.created</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>install</code>æ–¹æ³•é‡Œä¸»è¦æ˜¯<code>Vue.mixin</code>ç»™æ¯ä¸ªç»„ä»¶æ··å…¥äº†<code>beforeCreate</code>å’Œ <code>destroyed </code>æ–¹æ³•ï¼Œåœ¨Vueçš„åŸå‹é“¾ä¸Šå¢åŠ äº†<code>$router</code>å’Œ<code>$route</code>å¯¹è±¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨Vueçš„æ—¶å€™åœ¨thisä¸Šå¯ä»¥æ‹¿åˆ°è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œæ³¨å†Œäº†<code>router-view</code>å’Œ<code>router-link</code>ä¸¤ä¸ªç»„ä»¶ã€‚</p>
<h2 id="2-matcherå’Œroute"><a href="#2-matcherå’Œroute" class="headerlink" title="2. matcherå’Œroute"></a>2. matcherå’Œroute</h2><p>æ¥ä¸‹æ¥çœ‹çœ‹<code>matcher</code>çš„å®šä¹‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export type Matcher &#x3D; &#123;</span><br><span class="line">  match: (raw: RawLocation, current?: Route, redirectedFrom?: Location) &#x3D;&gt; Route;</span><br><span class="line">  addRoutes: (routes: Array&lt;RouteConfig&gt;) &#x3D;&gt; void;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>matcher</code>æš´éœ²äº†<code>match</code>æ–¹æ³•<code>addRoutes</code>æ–¹æ³•ï¼Œä»æ–¹æ³•çš„åå­—ä¸Šçœ‹ï¼Œmatchæ–¹æ³•æ˜¯ç”¨äºè·¯ç”±åŒ¹é…ï¼ŒaddRoutesåˆ™æ˜¯ç”¨æ¥æ·»åŠ è·¯ç”±é…ç½®ã€‚</p>
<p>åœ¨æ‰§è¡Œ<code>creatMatcher()</code>é‡Œç¬¬ä¸€ä»£æ®µä»£ç ç”Ÿæˆäº†<code>pathList</code>ã€<code>pathMap</code>ã€<code>nameMap</code>è¿™ä¸‰ä¸ªå¯¹è±¡ï¼Œè¿™æ˜¯åé¢è·¯ç”±æ‰§è¡ŒåŒ¹é…éå¸¸é‡è¦çš„é…ç½®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const &#123; pathList, pathMap, nameMap &#125; &#x3D; createRouteMap(routes)</span><br></pre></td></tr></table></figure>

<p><code>pathMap</code>å’Œ<code>nameMap</code>åˆ†åˆ«æ˜¯ä»¥routeé…ç½®çš„pathå’Œnameä¸ºkeyç”Ÿæˆçš„ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œå¯¹åº”valueä¸º<code>RouteRecord</code>å®ä¾‹ã€‚</p>
<p>ä¸‹é¢çœ‹çœ‹<code>RouteRecord</code>çš„å®šä¹‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">declare type RouteRecord &#x3D; &#123;</span><br><span class="line">  path: string;</span><br><span class="line">  regex: RouteRegExp;</span><br><span class="line">  components: Dictionary&lt;any&gt;;</span><br><span class="line">  instances: Dictionary&lt;any&gt;;</span><br><span class="line">  name: ?string;</span><br><span class="line">  parent: ?RouteRecord;</span><br><span class="line">  redirect: ?RedirectOption;</span><br><span class="line">  matchAs: ?string;</span><br><span class="line">  beforeEnter: ?NavigationGuard;</span><br><span class="line">  meta: any;</span><br><span class="line">  props: boolean | Object | Function | Dictionary&lt;boolean | Object | Function&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“åˆä»£ç é‡Œçš„å®é™…æ•°æ®å¯¹ç…§ç†è§£å„ä¸ªå±æ€§çš„å«ä¹‰ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/6/7/16b318773604a842?w=1598&h=522&f=png&s=132269"></p>
<table>
<thead>
<tr>
<th>key</th>
<th>value</th>
</tr>
</thead>
<tbody><tr>
<td>path</td>
<td>ä¼ å…¥çš„è·¯å¾„å€¼</td>
</tr>
<tr>
<td>regex</td>
<td>æ ¹æ®pathç”Ÿæˆçš„æ­£åˆ™åŒ¹é…è§„åˆ™</td>
</tr>
<tr>
<td>components</td>
<td>pathå¯¹åº”çš„ç»„ä»¶</td>
</tr>
<tr>
<td>instances</td>
<td>æ‰§è¡Œè·¯ç”±å®ˆå«æ–¹æ³•æ—¶ä¼ å…¥çš„routeå®ä¾‹</td>
</tr>
<tr>
<td>name</td>
<td>routeçš„name</td>
</tr>
<tr>
<td>parent</td>
<td>routeçš„çˆ¶çº§ï¼Œæ˜¯ä¸€ä¸ªé€’å½’çš„å¯¹è±¡ï¼Œä»æœ€åº•å±‚ä¸€ç›´åˆ°æœ€é¡¶å±‚ï¼Œæ— åˆ™ä¸ºundefined</td>
</tr>
<tr>
<td>redirect</td>
<td>é‡å®šå‘çš„è·¯å¾„</td>
</tr>
<tr>
<td>matchAs</td>
<td>ç”¨äºåŒ¹é…alias</td>
</tr>
<tr>
<td>props</td>
<td>ä¼ å…¥è·¯ç”±çš„å‚æ•°</td>
</tr>
</tbody></table>
<p>ç»“åˆä»¥ä¸Šè§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡º<code>vue-router</code>ä¸€ä¸ªå¤§æ¦‚çš„è¿è¡Œæ¦‚å¿µã€‚</p>
<ol>
<li><p>æ‰§è¡Œ<code>new Router()</code>ç”Ÿæˆè·¯ç”±é…ç½®å¯¹è±¡<code>routedRecord</code></p>
</li>
<li><p>è·¯ç”±åŒ¹é…æ ¹æ®<code>route</code>å¯¹è±¡çš„<code>regex</code>è¿›è¡ŒåŒ¹é…</p>
</li>
<li><p>æ ¹æ®<code>route</code>çš„<code>parent</code>å¯¹è±¡é€’å½’è·å–<code>component</code>ç»„ä»¶ç”Ÿæˆ<code>render Tree</code></p>
</li>
<li><p>æ‰§è¡Œå„ç»„ä»¶å¯¹åº”çš„å¯¼èˆªå®ˆå«æ–¹æ³•</p>
</li>
</ol>
<p>æ­¤æ–‡å¤§æ¦‚ç®€è¿°äº†vue-routeræ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Œä½†æ˜¯å¯¹äºrouterè·³è½¬çš„å…·ä½“æ‰§è¡Œå¹¶æ²¡æœ‰è¿›è¡Œæ·±å…¥è§£é‡Šï¼Œä¸‹ä¸€ç¯‡æ–‡ç« å°†ä¼šè¯¦ç»†è¯´æ˜routerè·³è½¬ä¹‹åæ˜¯å¦‚ä½•æ‰§è¡Œã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/07/%E5%AD%A6%E4%B9%A0vue-router%E6%BA%90%E7%A0%81%E8%AE%B0%E5%BD%95/" data-id="ckedpbruk000p1zm103ie4gsl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-HTTPåè®®ä»0-9-2-0çš„å˜åŒ–" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/01/HTTP%E5%8D%8F%E8%AE%AE%E4%BB%8E0-9-2-0%E7%9A%84%E5%8F%98%E5%8C%96/" class="article-date">
  <time datetime="2019-06-01T14:43:36.000Z" itemprop="datePublished">2019-06-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/HTTP/">HTTP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/01/HTTP%E5%8D%8F%E8%AE%AE%E4%BB%8E0-9-2-0%E7%9A%84%E5%8F%98%E5%8C%96/">HTTPåè®®ä»0.9-2.0çš„å˜åŒ–</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>HTTPæ˜¯æˆ‘ä»¬å‰ç«¯èµ–ä»¥å­˜åœ¨çš„åŸºç¡€ï¼ŒHTTPåè®®ä¸€ç›´åœ¨å˜åŒ–ï¼Œæˆ‘ä»¬åˆæ˜¯å¦çœŸçš„äº†è§£HTTPåè®®å‘¢ï¼Ÿä¸‹é¢ä¸€èµ·å­¦ä¹ HTTPåè®®çš„å˜åŒ–ï¼Œäº†è§£HTTPåè®®ä¸åŒç‰ˆæœ¬æ”¹è¿›çš„åœ°æ–¹ã€‚</p>
</blockquote>
<h3 id="HTTP-0-9"><a href="#HTTP-0-9" class="headerlink" title="HTTP/0.9"></a>HTTP/0.9</h3><p>HTTP/0.9æ˜¯æœ€æ—©çš„ç‰ˆæœ¬ï¼Œç¡®è®¤äº†HTTPåŸºäºTCPåè®®ã€‚è¿™ä¸ªç‰ˆæœ¬åªæ”¯æŒGETä¸€ä¸ªæ–¹æ³•ï¼Œä¸”æœåŠ¡å™¨åªèƒ½è¿”å›HTMLæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</p>
<h3 id="HTTP-1-0"><a href="#HTTP-1-0" class="headerlink" title="HTTP/1.0"></a>HTTP/1.0</h3><p>HTTP-1.0æ–°å¢äº†è®¸å¤šå†…å®¹ï¼ŒåŒ…æ‹¬æ”¯æŒä¸åŒç±»å‹çš„å“åº”æ ¼å¼ï¼Œä¾‹å¦‚å›¾åƒã€è§†é¢‘ç­‰ç­‰ã€‚æ–°å¢äº†HEADå’ŒPOSTè¯·æ±‚æ–¹æ³•ï¼Œè¡¥å……äº†å“åº”çŠ¶æ€ç ï¼Œæƒé™ï¼Œç¼“å­˜ç­‰åŠŸèƒ½ã€‚</p>
<h3 id="HTTP-1-1"><a href="#HTTP-1-1" class="headerlink" title="HTTP/1.1"></a>HTTP/1.1</h3><p>HTTP/1.1å¼•å…¥äº†æŒä¹…é“¾æ¥ä»¥åŠç®¡é“æœºåˆ¶ã€‚</p>
<h3 id="HTTP-2-0"><a href="#HTTP-2-0" class="headerlink" title="HTTP/2.0"></a>HTTP/2.0</h3><p>HTTP/2.0å¼•å…¥äº†äºŒè¿›åˆ¶ï¼Œå¤šè·¯å¤ç”¨ï¼ŒæœåŠ¡å™¨æ¨é€ï¼ˆsocketï¼‰ï¼Œæ•°æ®æµå’Œå¤´ä¿¡æ¯å‹ç¼©ä¼˜åŒ–ã€‚</p>
<h3 id="HTTP-3-0"><a href="#HTTP-3-0" class="headerlink" title="HTTP/3.0"></a>HTTP/3.0</h3><p>HTTP/3.0æ®è¯´å¼•å…¥äº†æ–°çš„åè®®ï¼ˆQUICï¼‰ï¼Œè¯¥åè®®è§£å†³äº†ä»¥å‰TCPåè®®æ‰€å­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶ä¸”æå¤§çš„æå‡äº†æ€§èƒ½ä¸å®‰å…¨æ€§ã€‚</p>
<h3 id="ä¸åŒç‰ˆæœ¬è§£å†³çš„é—®é¢˜"><a href="#ä¸åŒç‰ˆæœ¬è§£å†³çš„é—®é¢˜" class="headerlink" title="ä¸åŒç‰ˆæœ¬è§£å†³çš„é—®é¢˜"></a>ä¸åŒç‰ˆæœ¬è§£å†³çš„é—®é¢˜</h3><h4 id="0-9-â€“-gt-1-0"><a href="#0-9-â€“-gt-1-0" class="headerlink" title="0.9 â€“&gt; 1.0"></a>0.9 â€“&gt; 1.0</h4><p>ä»0.9åˆ°1.0ç‰ˆæœ¬ï¼ŒHTTPåè®®çš„å˜åŒ–æå¤§ä¸°å¯Œäº†å‰ç«¯é¡µé¢å¯ä»¥äº¤äº’çš„å†…å®¹ï¼Œåœ¨æœ€æ—©çš„æ—¶å€™å¯èƒ½æˆ‘ä»¬æ‰€çœ‹åˆ°çš„åªæœ‰ä¸€ä¸ªçº¯æ–‡æœ¬çš„é¡µé¢ï¼Œä½†æ˜¯åˆ°äº†1.0ç‰ˆæœ¬ï¼Œæ–°å¢äº†å›¾åƒã€éŸ³é¢‘ç­‰æ–°çš„å“åº”å†…å®¹ï¼Œå‰ç«¯å¯äº¤äº’çš„å†…å®¹å˜å¾—æ›´åŠ ä¸°å¯Œäº†ã€‚</p>
<h4 id="1-0-â€“-gt-1-1"><a href="#1-0-â€“-gt-1-1" class="headerlink" title="1.0 â€“&gt; 1.1"></a>1.0 â€“&gt; 1.1</h4><p>åœ¨1.0ç‰ˆæœ¬ï¼Œå› ä¸ºæ¯ä¸ªTCPåªèƒ½å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå‘é€æ•°æ®ä¹‹åè¿æ¥å°±ä¼šå…³é—­ï¼›æ¯æ¬¡å‘é€æ–°çš„è¯·æ±‚å°±éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œè€Œå»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥æˆæœ¬éå¸¸é«˜æ˜‚ï¼Œç”±æ­¤äº§ç”Ÿäº†<font color=red size=4>è¿æ¥æ— æ³•å¤ç”¨</font>çš„é—®é¢˜ï¼Œå­˜åœ¨æ€§èƒ½é—®é¢˜ã€‚1.1ç‰ˆæœ¬å¼•å…¥çš„æŒä¹…è¿æ¥å…è®¸ä¸€ä¸ªè¯·æ±‚åœ¨æ•°æ®è¿”å›ä¹‹åä¿ç•™ä¸€æ®µæ—¶é—´ï¼Œå’Œç®¡é“æœºåˆ¶å…è®¸æˆ‘ä»¬åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ã€‚</p>
<h3 id="1-1-â€“-gt-2-0"><a href="#1-1-â€“-gt-2-0" class="headerlink" title="1.1 â€“&gt; 2.0"></a>1.1 â€“&gt; 2.0</h3><p>åœ¨1.1ç‰ˆæœ¬å¼•å…¥çš„ç®¡é“æœºåˆ¶å…è®¸æˆ‘ä»¬åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä¾‹å¦‚åŒæ—¶å‘é€Aå’ŒBè¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿˜æ˜¯ä¼šæŒ‰ç…§é¡ºåºå…ˆå¤„ç†Aè¯·æ±‚ï¼Œç­‰Aå“åº”åå†å¤„ç†Bè¯·æ±‚ï¼Œç”±æ­¤äº§ç”Ÿäº†æˆ‘ä»¬æ‰€è¯´çš„<font color=red size=4>çº¿å¤´é˜»å¡ï¼ˆHead-of-line blockingï¼‰</font>é—®é¢˜ã€‚å¦‚æœç¬¬ä¸€ä¸ªå“åº”å¤„ç†éå¸¸ä¹…ï¼Œåˆ™ä¼šå¯¼è‡´åé¢çš„è¯·æ±‚å¿…é¡»ç­‰å¾…å‰é¢çš„è¯·æ±‚å¤„ç†å®Œä¹‹åæ‰èƒ½å¾—åˆ°å“åº”ã€‚</p>
<p>æ‰€ä»¥åœ¨2.0ç‰ˆæœ¬å¼•å…¥çš„å¤šè·¯å¤ç”¨å’Œæ•°æ®æµå…è®¸æˆ‘ä»¬ä¸ä¼šå—åˆ°å‰é¢å¤„ç†éå¸¸è€—æ—¶çš„è¯·æ±‚å½±å“ï¼Œå¯ä»¥åˆ†ä¼˜å…ˆçº§å¤„ç†å“åº”ã€‚åŒæ—¶å¼•å…¥äº†æœåŠ¡å™¨æ¨é€ï¼ˆsocketï¼‰å¢åŠ äº†å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åŒå‘é€šä¿¡çš„èƒ½åŠ›ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/06/01/HTTP%E5%8D%8F%E8%AE%AE%E4%BB%8E0-9-2-0%E7%9A%84%E5%8F%98%E5%8C%96/" data-id="ckedpbru700031zm18fc9hdnx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-é‡æ–°è®¤è¯†å‰ç«¯å¼€å‘ä½¿ç”¨çš„ã€å›¾ç‰‡ã€" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/26/%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8%E7%9A%84%E3%80%8E%E5%9B%BE%E7%89%87%E3%80%8F/" class="article-date">
  <time datetime="2019-05-26T14:43:49.000Z" itemprop="datePublished">2019-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/26/%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8%E7%9A%84%E3%80%8E%E5%9B%BE%E7%89%87%E3%80%8F/">é‡æ–°è®¤è¯†å‰ç«¯å¼€å‘ä½¿ç”¨çš„ã€å›¾ç‰‡ã€</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>å›¾ç‰‡åœ¨å‰ç«¯å¼€å‘ä¸­éå¸¸å¸¸ç”¨ï¼Œä½†æ˜¯å›¾ç‰‡çš„æ–‡ä»¶æ ¼å¼å´æ˜¯æœ‰å¾ˆå¤šç§ï¼Œå¹³å¸¸æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™å¯èƒ½ä¸ä¼šå¤ªåœ¨æ„è¿™æ–¹é¢ã€‚å®é™…ä¸Šä¸åŒçš„å›¾ç‰‡æ ¼å¼æœ‰ä¸åŒçš„åº”ç”¨çš„åœºæ™¯ï¼Œä»ä½“éªŒå’Œæ€§èƒ½ä¼˜åŒ–çš„è§’åº¦è€ƒè™‘ä¹Ÿæ˜¯å€¼å¾—æˆ‘ä»¬å­¦ä¹ ã€‚ä¸‹é¢å°†ç®€å•ä»‹ç»å›¾ç‰‡çš„å¸¸è§ç±»å‹ã€‚</p>
</blockquote>
<h2 id="å›¾ç‰‡ç±»å‹ä»‹ç»"><a href="#å›¾ç‰‡ç±»å‹ä»‹ç»" class="headerlink" title="å›¾ç‰‡ç±»å‹ä»‹ç»"></a>å›¾ç‰‡ç±»å‹ä»‹ç»</h2><h3 id="1-PNG"><a href="#1-PNG" class="headerlink" title="1.PNG"></a>1.PNG</h3><p>PNGæ ¼å¼æœ‰8ä½ã€24ä½ã€32ä½ä¸‰ç§å½¢å¼ï¼Œå…¶ä¸­8ä½PNGæ”¯æŒä¸¤ç§ä¸åŒçš„é€æ˜å½¢å¼ï¼ˆç´¢å¼•é€æ˜å’Œalphaé€æ˜ï¼‰ï¼Œ24ä½PNGä¸æ”¯æŒé€æ˜ï¼Œ32ä½PNGåœ¨24ä½åŸºç¡€ä¸Šå¢åŠ äº†8ä½é€æ˜é€šé“ï¼Œå› æ­¤å¯å±•ç°256çº§é€æ˜ç¨‹åº¦ã€‚</p>
<p>PNGå›¾ç‰‡æ”¯æŒæ— æŸå‹ç¼©ã€‚</p>
<h3 id="2-JPGï¼ˆJPEGï¼‰"><a href="#2-JPGï¼ˆJPEGï¼‰" class="headerlink" title="2.JPGï¼ˆJPEGï¼‰"></a>2.JPGï¼ˆJPEGï¼‰</h3><p>JPGå’ŒJPEGå…¶å®æ˜¯ä¸€ä¸ªæ ¼å¼ï¼Œè€Œä¸”å¯ç»†åˆ†ä¸ºBaseling-JPGå’ŒProgress-JPGä¸¤ç§ã€‚ä¸¤ç§ä¸åŒç±»å‹çš„å›¾ç‰‡å„æœ‰é€‚ç”¨åœºæ™¯ï¼Œé€šå¸¸æ¥è¯´ä½¿ç”¨Progressâ€”JPGç»™ç”¨æˆ·çš„ä½“éªŒæ›´å¥½ã€‚</p>
<p>JPGæ”¯æŒæœ‰æŸå‹ç¼©ã€‚</p>
<ol>
<li>Baseling-JPG<br><img src="https://user-gold-cdn.xitu.io/2019/5/25/16aee808d26687af?w=310&h=248&f=gif&s=48572"></li>
<li>Progressive-JPG<br><img src="https://user-gold-cdn.xitu.io/2019/5/25/16aee80dcf7cd3b8?w=310&h=248&f=gif&s=104715"></li>
</ol>
<h3 id="3-GIF"><a href="#3-GIF" class="headerlink" title="3.GIF"></a>3.GIF</h3><p>GIFç»å¸¸ç”¨äºåŠ¨ç”»çš„å›¾ç‰‡ä¸Šï¼Œæ”¯æŒæ— æŸå‹ç¼©ï¼Œæ”¯æŒèƒŒæ™¯é€æ˜ã€‚</p>
<h3 id="4-SVG"><a href="#4-SVG" class="headerlink" title="4.SVG"></a>4.SVG</h3><p>SVGï¼ˆå¯ç¼©æ”¾çŸ¢é‡å›¾å½¢ï¼‰è¿™ç§å›¾ç‰‡çš„ç±»å‹æˆ‘ä»¬å¯èƒ½ç”¨å¾—æ¯”è¾ƒå°‘ï¼Œå®é™…ä¸Šè¿™ç§æ ¼å¼çš„å›¾ç‰‡ä¼˜åŠ¿éå¸¸å¤šã€‚</p>
<ol>
<li>åŸºäºå¯æ‰©å±•æ ‡è®°è¯­è¨€</li>
<li>é‡‡ç”¨æ–‡æœ¬æ¥æè¿°å¯¹è±¡</li>
<li>å…·æœ‰äº¤äº’æ€§å’ŒåŠ¨æ€æ€§</li>
<li>å®Œå…¨æ”¯æŒDOM</li>
</ol>
<p>SVGæ”¯æŒæ— æŸå‹ç¼©å’ŒèƒŒæ™¯é€æ˜ï¼Œè€Œä¸”è¿˜æ”¯æŒåŠ¨ç”»ã€‚</p>
<p>ä½†æ˜¯ï¼ŒSVGç›¸æ¯”JPGå’ŒPNGæ¥è¯´ä¼˜åŠ¿è¿™ä¹ˆå¤§ä¸ºä½•å¹¶æ²¡æœ‰å¾ˆå¹¿æ³›çš„è¢«åº”ç”¨å‘¢ï¼Ÿè¿™å’ŒSVGçš„ä¸€éƒ¨åˆ†ä¼˜åŠ¿ç›¸å…³ï¼Œå› ä¸ºSVGå¤ªè¿‡çµæ´»ï¼Œå®é™…å¼€å‘ä¸­ç»´æŠ¤SVGå›¾ç‰‡æˆæœ¬éå¸¸é«˜ã€‚</p>
<h3 id="5-WebP"><a href="#5-WebP" class="headerlink" title="5.WebP"></a>5.WebP</h3><p>WebPæ˜¯è°·æ­Œå¼€å‘å‡ºæ¥çš„ä¸€ç§å›¾ç‰‡æ ¼å¼ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯ä¸€ä¸ªé€šå¸¸çš„æ ‡å‡†æ ¼å¼ï¼ˆä»…Chromeå’ŒOperaæ”¯æŒï¼‰ã€‚ä½†æ˜¯WebPå› ä¸ºå…¶è‡ªå®¶è°·æ­Œæµè§ˆå™¨çš„ä»½é¢é«˜å æœ‰ç‡ï¼ŒåŒæ—¶WebPç›¸æ¯”å…¶ä»–å¸¸ç”¨çš„å›¾ç‰‡æ ¼å¼å…·æœ‰æ›´å¤§çš„ä¼˜åŠ¿ï¼Œå®é™…å¼€å‘åº”ç”¨è¿˜æ˜¯æ¯”è¾ƒå¸¸è§ã€‚</p>
<p>WebPåŒæ—¶æ”¯æŒæ— æŸå’Œæœ‰æŸå‹ç¼©ï¼Œæ”¯æŒèƒŒæ™¯é€æ˜ã€‚</p>
<h3 id="6-APNG"><a href="#6-APNG" class="headerlink" title="6.APNG"></a>6.APNG</h3><p>APNGå…¶å®æ˜¯åœ¨PNGçš„åŸºç¡€ä¸Šæ‰©å±•äº†æ”¯æŒåŠ¨ç”»çš„å›¾ç‰‡æ–‡ä»¶æ ¼å¼ï¼Œè¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªé€šç”¨çš„æ ‡å‡†æ ¼å¼ï¼ˆä»…Safariå’ŒFirefoxæ”¯æŒï¼‰ã€‚</p>
<p>APNGæ”¯æŒæ— æŸå‹ç¼©ï¼ŒèƒŒæ™¯é€æ˜ï¼Œä¸”é¢å¤–æ”¯æŒåŠ¨ç”»ã€‚</p>
<h3 id="7-BPG"><a href="#7-BPG" class="headerlink" title="7.BPG"></a>7.BPG</h3><p>BPGæ˜¯ä¸€ç§å®éªŒæ€§çš„å›¾ç‰‡æ–‡ä»¶æ ¼å¼ï¼Œåœ¨æµè§ˆå™¨ä½¿ç”¨éœ€è¦æä¾›jsè§£ç ï¼Œè¯¥å›¾ç‰‡æ ¼å¼å¹¶æœªæˆä¸ºé€šç”¨æ ‡å‡†ã€‚ä½†æ˜¯å› ä¸ºå…¶ç›¸æ¯”å…¶ä»–å›¾ç‰‡æ ¼å¼ï¼Œå…·æœ‰æ›´é«˜å‹ç¼©æ¯”ï¼Œä¸”æ”¯æŒèƒŒæ™¯é€æ˜å’ŒåŠ¨ç”»ï¼ŒåŒæ—¶æ”¯æŒæ— æŸå‹ç¼©å’Œæœ‰æŸå‹ç¼©ï¼Œå®é™…ä¸Šæœ‰å¸Œæœ›æˆä¸ºæ–°çš„ä¸»æµå›¾ç‰‡æ ¼å¼ã€‚</p>
<h2 id="æœ‰æŸå‹ç¼©å’Œæ— æŸå‹ç¼©"><a href="#æœ‰æŸå‹ç¼©å’Œæ— æŸå‹ç¼©" class="headerlink" title="æœ‰æŸå‹ç¼©å’Œæ— æŸå‹ç¼©"></a>æœ‰æŸå‹ç¼©å’Œæ— æŸå‹ç¼©</h2><p>å‰é¢ä»‹ç»å›¾ç‰‡çš„æ—¶å€™æåˆ°çš„æ— æŸå‹ç¼©å’Œæœ‰æŸå‹ç¼©æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®é™…ä¸Šè¿™ä¸ªæ¦‚å¿µé€‚ç”¨å¾ˆå¤šåœ°æ–¹ï¼ˆè§†é¢‘ï¼ŒéŸ³é¢‘ç­‰ï¼‰ï¼Œç®€å•è¯´è¯´è¿™ä¸¤ä¸ªçš„æ¦‚å¿µã€‚</p>
<p>1.æœ‰æŸå‹ç¼©</p>
<p>æœ‰æŸå‹ç¼©æ˜¯åˆ©ç”¨äº†äººç±»å¯¹å›¾åƒæˆ–å£°æ³¢ä¸­çš„æŸäº›é¢‘ç‡æˆåˆ†ä¸æ•æ„Ÿçš„ç‰¹æ€§ï¼Œå…è®¸å‹ç¼©è¿‡ç¨‹ä¸­æŸå¤±ä¸€å®šçš„ä¿¡æ¯ï¼›è™½ç„¶ä¸èƒ½å®Œå…¨æ¢å¤åŸå§‹æ•°æ®ï¼Œä½†æ˜¯æ‰€æŸå¤±çš„éƒ¨åˆ†å¯¹ç†è§£åŸå§‹å›¾åƒçš„å½±å“ç¼©å°ï¼Œå´æ¢æ¥äº†å¤§å¾—å¤šçš„å‹ç¼©æ¯”ã€‚</p>
<p>2.æ— æŸå‹ç¼©</p>
<p>æ— æŸå‹ç¼©æ ¼å¼ï¼Œæ˜¯åˆ©ç”¨æ•°æ®çš„ç»Ÿè®¡å†—ä½™è¿›è¡Œå‹ç¼©ï¼Œå¯å®Œå…¨æ¢å¤åŸå§‹æ•°æ®è€Œä¸å¼•èµ·ä»»ä½•å¤±çœŸã€‚</p>
<blockquote>
<p>å›¾ç‰‡é‡Œæœ‰æŸå‹ç¼©ç‰ºç‰²äº†éƒ¨åˆ†å›¾ç‰‡ç»†èŠ‚ï¼Œä»¥æ­¤æ¢æ¥æ›´å¤§çš„å‹ç¼©æ¯”ã€‚</p>
</blockquote>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><table>
<thead>
<tr>
<th>å›¾ç‰‡æ ¼å¼</th>
<th>æ”¯æŒé€æ˜</th>
<th>æ”¯æŒåŠ¨ç”»</th>
<th>å‹ç¼©æ–¹å¼</th>
<th>æµè§ˆå™¨æ”¯æŒ</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>PNG</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æ— æŸå‹ç¼©</td>
<td>æ‰€æœ‰</td>
<td>éœ€è¦é€æ˜æ—¶</td>
</tr>
<tr>
<td>JPG</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æœ‰æŸå‹ç¼©</td>
<td>æ‰€æœ‰</td>
<td>é€šç”¨åœºæ™¯</td>
</tr>
<tr>
<td>GIF</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ— æŸå‹ç¼©</td>
<td>æ‰€æœ‰</td>
<td>ç®€å•é¢œè‰²ã€åŠ¨ç”»</td>
</tr>
<tr>
<td>SVG</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ— æŸå‹ç¼©</td>
<td>æ‰€æœ‰</td>
<td>éœ€è¦è‰¯å¥½ç¼©æ”¾ä½“éªŒï¼ŒåŠ¨æ€æ§åˆ¶å›¾ç‰‡ç‰¹æ•ˆ</td>
</tr>
<tr>
<td>WebP</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æœ‰æŸå‹ç¼©å’Œæ— æŸå‹ç¼©</td>
<td>Chromeã€Opera</td>
<td>å¤æ‚é¢œè‰²ã€å¹³å°å¯çŸ¥</td>
</tr>
<tr>
<td>APNG</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ— æŸå‹ç¼©</td>
<td>Firefoxã€Safari</td>
<td>åŠé€æ˜åŠ¨ç”»</td>
</tr>
<tr>
<td>BPG</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æœ‰æŸå‹ç¼©å’Œæ— æŸå‹ç¼©</td>
<td>æ— ï¼Œéœ€è¦JSè§£ç </td>
<td>æè‡´æ€§èƒ½ä¼˜åŒ–</td>
</tr>
</tbody></table>
<p>åœ¨å¼€å‘ä¸­è™½ç„¶ç»å¸¸ç”¨åˆ°äº†å›¾ç‰‡ï¼Œä½†æ˜¯å¯¹ä¸åŒçš„å›¾ç‰‡æ ¼å¼å¹¶æ²¡æœ‰å¤ªå¤šè®¤çŸ¥ï¼Œå¸Œæœ›é€šè¿‡é‡æ–°å­¦ä¹ å›¾ç‰‡çš„çŸ¥è¯†ï¼Œå¢å¼ºè‡ªå·±çš„ä¸šåŠ¡èƒ½åŠ›ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/05/26/%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8%E7%9A%84%E3%80%8E%E5%9B%BE%E7%89%87%E3%80%8F/" data-id="ckedpbrv8002e1zm1c9i0hw3z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">ä¸‹ä¸€é¡µ &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/Vue/">Vue</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/" rel="tag">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/Node-js/" style="font-size: 10px;">Node.js</a> <a href="/tags/Vue/" style="font-size: 20px;">Vue</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">å…«æœˆ 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">å…«æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">ä¸ƒæœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">å…­æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">äº”æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">å››æœˆ 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">ä¸‰æœˆ 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/08/15/JS%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%88%A4%E6%96%AD/">JSæ•°æ®ç±»å‹åˆ¤æ–­</a>
          </li>
        
          <li>
            <a href="/2019/08/10/CSS%E5%AE%B9%E6%98%93%E5%BF%BD%E7%95%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9/">CSSå®¹æ˜“å¿½ç•¥çš„ä¸€äº›çŸ¥è¯†ç‚¹</a>
          </li>
        
          <li>
            <a href="/2019/07/15/%E5%AD%A6%E4%B9%A0vuex%E6%BA%90%E7%A0%81/">å­¦ä¹ vuexæºç </a>
          </li>
        
          <li>
            <a href="/2019/07/07/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94nextTick/">å­¦ä¹ vueæºç â€”nextTick</a>
          </li>
        
          <li>
            <a href="/2019/06/30/%E5%AD%A6%E4%B9%A0vue%E6%BA%90%E7%A0%81%E2%80%94mvvm/">å­¦ä¹ vueæºç â€”mvvm</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Mr.Onion<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>